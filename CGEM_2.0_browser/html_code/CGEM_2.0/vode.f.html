<HTML> <BODY BGCOLOR=#eeeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<A NAME='DVODE'><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>DVODE</font> (F, NEQ, Y, T, TOUT, ITOL, RTOL, ATOL, ITASK, <A href='../../call_to/DVODE.html' TARGET='index'>1</A>,<A href='../../call_from/DVODE.html' TARGET='index'>60</A><a name='3'>
     1            ISTATE, IOPT, RWORK, LRW, IWORK, LIW, JAC, MF,<a name='4'>
     2            RPAR, IPAR)<a name='5'>
      EXTERNAL F, JAC<a name='6'>
      INTEGER NEQ, ITOL, ITASK, ISTATE, IOPT, LRW, IWORK, LIW,<a name='7'>
     1        MF, IPAR<a name='8'>
      DOUBLE PRECISION Y, T, TOUT, RTOL, ATOL, RWORK, RPAR<a name='9'>
      DIMENSION Y(*), RTOL(*), ATOL(*), RWORK(LRW), IWORK(LIW),<a name='10'>
     1          RPAR(*), IPAR(*)<a name='11'>
C<a name='12'>
      DOUBLE PRECISION ACNRM, CCMXJ, CONP, CRATE, DRC, EL,<a name='13'>
     1     ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='14'>
     2     RC, RL1, TAU, TQ, TN, UROUND<a name='15'>
      INTEGER ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='16'>
     1        L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='17'>
     2        LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='18'>
     3        N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='19'>
     4        NSLP, NYH<a name='20'>
C<a name='21'>
C Type declarations for labeled COMMON block VOD002 --------------------<a name='22'>
C<a name='23'>
      DOUBLE PRECISION HU<a name='24'>
      INTEGER NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='25'>
C<a name='26'>
C Type declarations for local variables --------------------------------<a name='27'>
C<a name='28'>
      EXTERNAL VNLSD<a name='29'>
      LOGICAL IHIT<a name='30'>
      DOUBLE PRECISION ATOLI, BIG, EWTI, FOUR, H0, HMAX, HMX, HUN, ONE,<a name='31'>
     1   PT2, D1MACH, RH, RTOLI, SIZE, TCRIT, TNEXT, TOLSF, TP, TWO,<a name='32'>
     2   ZERO, VNORM<a name='33'>
      INTEGER I, IER, IFLAG, IMXER, JCO, KGO, LENIW, LENJ, LENP, LENRW,<a name='34'>
     1   LENWM, LF0, MBAND, ML, MORD, MU, MXHNL0, MXSTP0, NITER, NSLAST<a name='35'>
      CHARACTER*80 MSG<a name='36'>
C<a name='37'>
      DIMENSION MORD(2)<a name='38'>
C-----------------------------------------------------------------------<a name='39'>
C The following Fortran-77 declaration is to cause the values of the<a name='40'>
C listed (local) variables to be saved between calls to VODE.<a name='41'>
C-----------------------------------------------------------------------<a name='42'>
      SAVE ZERO, ONE, TWO, FOUR, PT2, HUN<a name='43'>
C-----------------------------------------------------------------------<a name='44'>
      COMMON /VOD001/ ACNRM, CCMXJ, CONP, CRATE, DRC, EL(13),<a name='45'>
     1                ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='46'>
     2                RC, RL1, TAU(13), TQ(5), TN, UROUND,<a name='47'>
     3                ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='48'>
     4                L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='49'>
     5                LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='50'>
     6                N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='51'>
     7                NSLP, NYH<a name='52'>
      COMMON /VOD002/ HU, NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='53'>
C<a name='54'>
      DATA  MORD(1) /12/, MORD(2) /5/, MXSTP0 /500/, MXHNL0 /10/<a name='55'>
      DATA ZERO /0.0D0/, ONE /1.0D0/, TWO /2.0D0/, FOUR /4.0D0/,<a name='56'>
     1     PT2 /0.2D0/, HUN /100.0D0/<a name='57'>
C-----------------------------------------------------------------------<a name='58'>
C-----------------------------------------------------------------------<a name='59'>
      IF (ISTATE .LT. 1 .OR. ISTATE .GT. 3) GO TO 601<a name='60'>
      IF (ITASK .LT. 1 .OR. ITASK .GT. 5) GO TO 602<a name='61'>
      IF (ISTATE .EQ. 1) GO TO 10<a name='62'>
      IF (INIT .NE. 1) GO TO 603<a name='63'>
      IF (ISTATE .EQ. 2) GO TO 200<a name='64'>
      GO TO 20<a name='65'>
 10   INIT = 0<a name='66'>
      IF (TOUT .EQ. T) RETURN<a name='67'>
C-----------------------------------------------------------------------<a name='68'>
C-----------------------------------------------------------------------<a name='69'>
 20   IF (NEQ .LE. 0) GO TO 604<a name='70'>
      IF (ISTATE .EQ. 1) GO TO 25<a name='71'>
      IF (NEQ .GT. N) GO TO 605<a name='72'>
 25   N = NEQ<a name='73'>
      IF (ITOL .LT. 1 .OR. ITOL .GT. 4) GO TO 606<a name='74'>
      IF (IOPT .LT. 0 .OR. IOPT .GT. 1) GO TO 607<a name='75'>
      JSV = ISIGN(1,MF)<a name='76'>
      MF = IABS(MF)<a name='77'>
      METH = MF/10<a name='78'>
      MITER = MF - 10*METH<a name='79'>
      IF (METH .LT. 1 .OR. METH .GT. 2) GO TO 608<a name='80'>
      IF (MITER .LT. 0 .OR. MITER .GT. 5) GO TO 608<a name='81'>
      IF (MITER .LE. 3) GO TO 30<a name='82'>
      ML = IWORK(1)<a name='83'>
      MU = IWORK(2)<a name='84'>
      IF (ML .LT. 0 .OR. ML .GE. N) GO TO 609<a name='85'>
      IF (MU .LT. 0 .OR. MU .GE. N) GO TO 610<a name='86'>
 30   CONTINUE<a name='87'>
C Next process and check the optional input. ---------------------------<a name='88'>
      IF (IOPT .EQ. 1) GO TO 40<a name='89'>
      MAXORD = MORD(METH)<a name='90'>
      MXSTEP = MXSTP0<a name='91'>
      MXHNIL = MXHNL0<a name='92'>
      IF (ISTATE .EQ. 1) H0 = ZERO<a name='93'>
      HMXI = ZERO<a name='94'>
      HMIN = ZERO<a name='95'>
      GO TO 60<a name='96'>
 40   MAXORD = IWORK(5)<a name='97'>
      IF (MAXORD .LT. 0) GO TO 611<a name='98'>
      IF (MAXORD .EQ. 0) MAXORD = 100<a name='99'>
      MAXORD = MIN0(MAXORD,MORD(METH))<a name='100'>
      MXSTEP = IWORK(6)<a name='101'>
      IF (MXSTEP .LT. 0) GO TO 612<a name='102'>
      IF (MXSTEP .EQ. 0) MXSTEP = MXSTP0<a name='103'>
      MXHNIL = IWORK(7)<a name='104'>
      IF (MXHNIL .LT. 0) GO TO 613<a name='105'>
      IF (MXHNIL .EQ. 0) MXHNIL = MXHNL0<a name='106'>
      IF (ISTATE .NE. 1) GO TO 50<a name='107'>
      H0 = RWORK(5)<a name='108'>
      IF ((TOUT - T)*H0 .LT. ZERO) GO TO 614<a name='109'>
 50   HMAX = RWORK(6)<a name='110'>
      IF (HMAX .LT. ZERO) GO TO 615<a name='111'>
      HMXI = ZERO<a name='112'>
      IF (HMAX .GT. ZERO) HMXI = ONE/HMAX<a name='113'>
      HMIN = RWORK(7)<a name='114'>
      IF (HMIN .LT. ZERO) GO TO 616<a name='115'>
C-----------------------------------------------------------------------<a name='116'>
C-----------------------------------------------------------------------<a name='117'>
 60   LYH = 21<a name='118'>
      IF (ISTATE .EQ. 1) NYH = N<a name='119'>
      LWM = LYH + (MAXORD + 1)*NYH<a name='120'>
      JCO = MAX0(0,JSV)<a name='121'>
      IF (MITER .EQ. 0) LENWM = 0<a name='122'>
      IF (MITER .EQ. 1 .OR. MITER .EQ. 2) THEN<a name='123'>
        LENWM = 2 + (1 + JCO)*N*N<a name='124'>
        LOCJS = N*N + 3<a name='125'>
      ENDIF<a name='126'>
      IF (MITER .EQ. 3) LENWM = 2 + N<a name='127'>
      IF (MITER .EQ. 4 .OR. MITER .EQ. 5) THEN<a name='128'>
        MBAND = ML + MU + 1<a name='129'>
        LENP = (MBAND + ML)*N<a name='130'>
        LENJ = MBAND*N<a name='131'>
        LENWM = 2 + LENP + JCO*LENJ<a name='132'>
        LOCJS = LENP + 3<a name='133'>
        ENDIF<a name='134'>
      LEWT = LWM + LENWM<a name='135'>
      LSAVF = LEWT + N<a name='136'>
      LACOR = LSAVF + N<a name='137'>
      LENRW = LACOR + N - 1<a name='138'>
      IWORK(17) = LENRW<a name='139'>
      LIWM = 1<a name='140'>
      LENIW = 30 + N<a name='141'>
      IF (MITER .EQ. 0 .OR. MITER .EQ. 3) LENIW = 30<a name='142'>
      IWORK(18) = LENIW<a name='143'>
      IF (LENRW .GT. LRW) GO TO 617<a name='144'>
      IF (LENIW .GT. LIW) GO TO 618<a name='145'>
C Check RTOL and ATOL for legality. ------------------------------------<a name='146'>
      RTOLI = RTOL(1)<a name='147'>
      ATOLI = ATOL(1)<a name='148'>
      DO 70 I = 1,N<a name='149'>
        IF (ITOL .GE. 3) RTOLI = RTOL(I)<a name='150'>
        IF (ITOL .EQ. 2 .OR. ITOL .EQ. 4) ATOLI = ATOL(I)<a name='151'>
        IF (RTOLI .LT. ZERO) GO TO 619<a name='152'>
        IF (ATOLI .LT. ZERO) GO TO 620<a name='153'>
 70     CONTINUE<a name='154'>
      IF (ISTATE .EQ. 1) GO TO 100<a name='155'>
C If ISTATE = 3, set flag to signal parameter changes to VSTEP. --------<a name='156'>
      JSTART = -1<a name='157'>
      IF (NQ .LE. MAXORD) GO TO 90<a name='158'>
C MAXORD was reduced below NQ.  Copy YH(*,MAXORD+2) into SAVF. ---------<a name='159'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_1"> (N, RWORK(LWM), 1, RWORK(LSAVF), 1)<a name='160'>
C Reload WM(1) = RWORK(LWM), since LWM may have changed. ---------------<a name='161'>
 90   IF (MITER .GT. 0) RWORK(LWM) = DSQRT(UROUND)<a name='162'>
C-----------------------------------------------------------------------<a name='163'>
C-----------------------------------------------------------------------<a name='164'>
 100  UROUND = <A href='../../html_code/CGEM_2.0/vode.f.html#D1MACH'>D1MACH</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="D1MACH_1">(4)<a name='165'>
      TN = T<a name='166'>
      IF (ITASK .NE. 4 .AND. ITASK .NE. 5) GO TO 110<a name='167'>
      TCRIT = RWORK(1)<a name='168'>
      IF ((TCRIT - TOUT)*(TOUT - T) .LT. ZERO) GO TO 625<a name='169'>
      IF (H0 .NE. ZERO .AND. (T + H0 - TCRIT)*H0 .GT. ZERO)<a name='170'>
     1   H0 = TCRIT - T<a name='171'>
 110  JSTART = 0<a name='172'>
      IF (MITER .GT. 0) RWORK(LWM) = DSQRT(UROUND)<a name='173'>
      CCMXJ = PT2<a name='174'>
      MSBJ = 50<a name='175'>
      NHNIL = 0<a name='176'>
      NST = 0<a name='177'>
      NJE = 0<a name='178'>
      NNI = 0<a name='179'>
      NCFN = 0<a name='180'>
      NETF = 0<a name='181'>
      NLU = 0<a name='182'>
      NSLJ = 0<a name='183'>
      NSLAST = 0<a name='184'>
      HU = ZERO<a name='185'>
      NQU = 0<a name='186'>
C Initial call to F.  (LF0 points to YH(*,2).) -------------------------<a name='187'>
      LF0 = LYH + NYH<a name='188'>
      CALL F (N, T, Y, RWORK(LF0), RPAR, IPAR)<a name='189'>
      NFE = 1<a name='190'>
C Load the initial value vector in YH. ---------------------------------<a name='191'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_2"> (N, Y, 1, RWORK(LYH), 1)<a name='192'>
C Load and invert the EWT array.  (H is temporarily set to 1.0.) -------<a name='193'>
      NQ = 1<a name='194'>
      H = ONE<a name='195'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#EWSET'>EWSET</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EWSET_1"> (N, ITOL, RTOL, ATOL, RWORK(LYH), RWORK(LEWT))<a name='196'>
      DO 120 I = 1,N<a name='197'>
        IF (RWORK(I+LEWT-1) .LE. ZERO) GO TO 621<a name='198'>
 120    RWORK(I+LEWT-1) = ONE/RWORK(I+LEWT-1)<a name='199'>
      IF (H0 .NE. ZERO) GO TO 180<a name='200'>
C Call VHIN to set initial step size H0 to be attempted. ---------------<a name='201'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VHIN'>VHIN</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VHIN_1"> (N, T, RWORK(LYH), RWORK(LF0), F, RPAR, IPAR, TOUT,<a name='202'>
     1   UROUND, RWORK(LEWT), ITOL, ATOL, Y, RWORK(LACOR), H0,<a name='203'>
     2   NITER, IER)<a name='204'>
      NFE = NFE + NITER<a name='205'>
      IF (IER .NE. 0) GO TO 622<a name='206'>
C Adjust H0 if necessary to meet HMAX bound. ---------------------------<a name='207'>
 180  RH = DABS(H0)*HMXI<a name='208'>
      IF (RH .GT. ONE) H0 = H0/RH<a name='209'>
C Load H with H0 and scale YH(*,2) by H0. ------------------------------<a name='210'>
      H = H0<a name='211'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL'>DSCAL</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DSCAL_1"> (N, H0, RWORK(LF0), 1)<a name='212'>
      GO TO 270<a name='213'>
C-----------------------------------------------------------------------<a name='214'>
C-----------------------------------------------------------------------<a name='215'>
 200  NSLAST = NST<a name='216'>
      KUTH = 0<a name='217'>
      GO TO (210, 250, 220, 230, 240), ITASK<a name='218'>
 210  IF ((TN - TOUT)*H .LT. ZERO) GO TO 250<a name='219'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VINDY'>VINDY</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VINDY_1"> (TOUT, 0, RWORK(LYH), NYH, Y, IFLAG)<a name='220'>
      IF (IFLAG .NE. 0) GO TO 627<a name='221'>
      T = TOUT<a name='222'>
      GO TO 420<a name='223'>
 220  TP = TN - HU*(ONE + HUN*UROUND)<a name='224'>
      IF ((TP - TOUT)*H .GT. ZERO) GO TO 623<a name='225'>
      IF ((TN - TOUT)*H .LT. ZERO) GO TO 250<a name='226'>
      GO TO 400<a name='227'>
 230  TCRIT = RWORK(1)<a name='228'>
      IF ((TN - TCRIT)*H .GT. ZERO) GO TO 624<a name='229'>
      IF ((TCRIT - TOUT)*H .LT. ZERO) GO TO 625<a name='230'>
      IF ((TN - TOUT)*H .LT. ZERO) GO TO 245<a name='231'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VINDY'>VINDY</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VINDY_2"> (TOUT, 0, RWORK(LYH), NYH, Y, IFLAG)<a name='232'>
      IF (IFLAG .NE. 0) GO TO 627<a name='233'>
      T = TOUT<a name='234'>
      GO TO 420<a name='235'>
 240  TCRIT = RWORK(1)<a name='236'>
      IF ((TN - TCRIT)*H .GT. ZERO) GO TO 624<a name='237'>
 245  HMX = DABS(TN) + DABS(H)<a name='238'>
      IHIT = DABS(TN - TCRIT) .LE. HUN*UROUND*HMX<a name='239'>
      IF (IHIT) GO TO 400<a name='240'>
      TNEXT = TN + HNEW*(ONE + FOUR*UROUND)<a name='241'>
      IF ((TNEXT - TCRIT)*H .LE. ZERO) GO TO 250<a name='242'>
      H = (TCRIT - TN)*(ONE - FOUR*UROUND)<a name='243'>
      KUTH = 1<a name='244'>
C-----------------------------------------------------------------------<a name='245'>
C-----------------------------------------------------------------------<a name='246'>
 250  CONTINUE<a name='247'>
      IF ((NST-NSLAST) .GE. MXSTEP) GO TO 500<a name='248'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#EWSET'>EWSET</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EWSET_2"> (N, ITOL, RTOL, ATOL, RWORK(LYH), RWORK(LEWT))<a name='249'>
      DO 260 I = 1,N<a name='250'>
        IF (RWORK(I+LEWT-1) .LE. ZERO) GO TO 510<a name='251'>
 260    RWORK(I+LEWT-1) = ONE/RWORK(I+LEWT-1)<a name='252'>
 270  TOLSF = UROUND*<A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_1"> (N, RWORK(LYH), RWORK(LEWT))<a name='253'>
      IF (TOLSF .LE. ONE) GO TO 280<a name='254'>
      TOLSF = TOLSF*TWO<a name='255'>
      IF (NST .EQ. 0) GO TO 626<a name='256'>
      GO TO 520<a name='257'>
 280  IF ((TN + H) .NE. TN) GO TO 290<a name='258'>
      NHNIL = NHNIL + 1<a name='259'>
      IF (NHNIL .GT. MXHNIL) GO TO 290<a name='260'>
      MSG = 'VODE--   Warning..internal T (=R1) and H (=R2) are'<a name='261'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_1"> (MSG, 50, 101, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='262'>
      MSG='      such that in the machine, T + H = T on the next step  '<a name='263'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_2"> (MSG, 60, 101, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='264'>
      MSG = '      (H = step size). solver will continue anyway'<a name='265'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_3"> (MSG, 50, 101, 1, 0, 0, 0, 2, TN, H)<a name='266'>
      IF (NHNIL .LT. MXHNIL) GO TO 290<a name='267'>
      MSG = 'VODE--   Above warning has been issued I1 times.  '<a name='268'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_4"> (MSG, 50, 102, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='269'>
      MSG = '      it will not be issued again for this problem'<a name='270'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_5"> (MSG, 50, 102, 1, 1, MXHNIL, 0, 0, ZERO, ZERO)<a name='271'>
 290  CONTINUE<a name='272'>
C-----------------------------------------------------------------------<a name='273'>
C-----------------------------------------------------------------------<a name='274'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP'>VSTEP</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VSTEP_1"> (Y, RWORK(LYH), NYH, RWORK(LYH), RWORK(LEWT),<a name='275'>
     1   RWORK(LSAVF), Y, RWORK(LACOR), RWORK(LWM), IWORK(LIWM),<a name='276'>
     2   F, JAC, F, VNLSD, RPAR, IPAR)<a name='277'>
      KGO = 1 - KFLAG<a name='278'>
C Branch on KFLAG.  Note..In this version, KFLAG can not be set to -3.<a name='279'>
C  KFLAG .eq. 0,   -1,  -2<a name='280'>
      GO TO (300, 530, 540), KGO<a name='281'>
C-----------------------------------------------------------------------<a name='282'>
C-----------------------------------------------------------------------<a name='283'>
 300  INIT = 1<a name='284'>
      KUTH = 0<a name='285'>
      GO TO (310, 400, 330, 340, 350), ITASK<a name='286'>
C ITASK = 1.  If TOUT has been reached, interpolate. -------------------<a name='287'>
 310  IF ((TN - TOUT)*H .LT. ZERO) GO TO 250<a name='288'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VINDY'>VINDY</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VINDY_3"> (TOUT, 0, RWORK(LYH), NYH, Y, IFLAG)<a name='289'>
      T = TOUT<a name='290'>
      GO TO 420<a name='291'>
C ITASK = 3.  Jump to exit if TOUT was reached. ------------------------<a name='292'>
 330  IF ((TN - TOUT)*H .GE. ZERO) GO TO 400<a name='293'>
      GO TO 250<a name='294'>
C ITASK = 4.  See if TOUT or TCRIT was reached.  Adjust H if necessary.<a name='295'>
 340  IF ((TN - TOUT)*H .LT. ZERO) GO TO 345<a name='296'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VINDY'>VINDY</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VINDY_4"> (TOUT, 0, RWORK(LYH), NYH, Y, IFLAG)<a name='297'>
      T = TOUT<a name='298'>
      GO TO 420<a name='299'>
 345  HMX = DABS(TN) + DABS(H)<a name='300'>
      IHIT = DABS(TN - TCRIT) .LE. HUN*UROUND*HMX<a name='301'>
      IF (IHIT) GO TO 400<a name='302'>
      TNEXT = TN + HNEW*(ONE + FOUR*UROUND)<a name='303'>
      IF ((TNEXT - TCRIT)*H .LE. ZERO) GO TO 250<a name='304'>
      H = (TCRIT - TN)*(ONE - FOUR*UROUND)<a name='305'>
      KUTH = 1<a name='306'>
      GO TO 250<a name='307'>
C ITASK = 5.  See if TCRIT was reached and jump to exit. ---------------<a name='308'>
 350  HMX = DABS(TN) + DABS(H)<a name='309'>
      IHIT = DABS(TN - TCRIT) .LE. HUN*UROUND*HMX<a name='310'>
C-----------------------------------------------------------------------<a name='311'>
C-----------------------------------------------------------------------<a name='312'>
 400  CONTINUE<a name='313'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_3"> (N, RWORK(LYH), 1, Y, 1)<a name='314'>
      T = TN<a name='315'>
      IF (ITASK .NE. 4 .AND. ITASK .NE. 5) GO TO 420<a name='316'>
      IF (IHIT) T = TCRIT<a name='317'>
 420  ISTATE = 2<a name='318'>
      RWORK(11) = HU<a name='319'>
      RWORK(12) = HNEW<a name='320'>
      RWORK(13) = TN<a name='321'>
      IWORK(11) = NST<a name='322'>
      IWORK(12) = NFE<a name='323'>
      IWORK(13) = NJE<a name='324'>
      IWORK(14) = NQU<a name='325'>
      IWORK(15) = NEWQ<a name='326'>
      IWORK(19) = NLU<a name='327'>
      IWORK(20) = NNI<a name='328'>
      IWORK(21) = NCFN<a name='329'>
      IWORK(22) = NETF<a name='330'>
      RETURN<a name='331'>
C-----------------------------------------------------------------------<a name='332'>
C-----------------------------------------------------------------------<a name='333'>
C The maximum number of steps was taken before reaching TOUT. ----------<a name='334'>
 500  MSG = 'VODE--   At current T (=R1), MXSTEP (=I1) steps   '<a name='335'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_6"> (MSG, 50, 201, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='336'>
      MSG = '      taken on this call before reaching TOUT     '<a name='337'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_7"> (MSG, 50, 201, 1, 1, MXSTEP, 0, 1, TN, ZERO)<a name='338'>
      ISTATE = -1<a name='339'>
      GO TO 580<a name='340'>
C EWT(i) .le. 0.0 for some i (not at start of problem). ----------------<a name='341'>
 510  EWTI = RWORK(LEWT+I-1)<a name='342'>
      MSG = 'VODE--   At T (=R1), EWT(I1) has become R2 .le. 0.'<a name='343'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_8"> (MSG, 50, 202, 1, 1, I, 0, 2, TN, EWTI)<a name='344'>
      ISTATE = -6<a name='345'>
      GO TO 580<a name='346'>
C Too much accuracy requested for machine precision. -------------------<a name='347'>
 520  MSG = 'VODE--   At T (=R1), too much accuracy requested  '<a name='348'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_9"> (MSG, 50, 203, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='349'>
      MSG = '      for precision of machine..  see TOLSF (=R2) '<a name='350'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_10"> (MSG, 50, 203, 1, 0, 0, 0, 2, TN, TOLSF)<a name='351'>
      RWORK(14) = TOLSF<a name='352'>
      ISTATE = -2<a name='353'>
      GO TO 580<a name='354'>
C KFLAG = -1.  Error test failed repeatedly or with ABS(H) = HMIN. -----<a name='355'>
 530  MSG = 'VODE--   At T(=R1) and step size H(=R2), the error'<a name='356'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_11"> (MSG, 50, 204, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='357'>
      MSG = '      test failed repeatedly or with abs(H) = HMIN'<a name='358'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_12"> (MSG, 50, 204, 1, 0, 0, 0, 2, TN, H)<a name='359'>
      ISTATE = -4<a name='360'>
      GO TO 560<a name='361'>
C KFLAG = -2.  Convergence failed repeatedly or with abs(H) = HMIN. ----<a name='362'>
 540  MSG = 'VODE--   At T (=R1) and step size H (=R2), the    '<a name='363'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_13"> (MSG, 50, 205, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='364'>
      MSG = '      corrector convergence failed repeatedly     '<a name='365'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_14"> (MSG, 50, 205, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='366'>
      MSG = '      or with abs(H) = HMIN   '<a name='367'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_15"> (MSG, 30, 205, 1, 0, 0, 0, 2, TN, H)<a name='368'>
      ISTATE = -5<a name='369'>
C Compute IMXER if relevant. -------------------------------------------<a name='370'>
 560  BIG = ZERO<a name='371'>
      IMXER = 1<a name='372'>
      DO 570 I = 1,N<a name='373'>
        SIZE = DABS(RWORK(I+LACOR-1)*RWORK(I+LEWT-1))<a name='374'>
        IF (BIG .GE. SIZE) GO TO 570<a name='375'>
        BIG = SIZE<a name='376'>
        IMXER = I<a name='377'>
 570    CONTINUE<a name='378'>
      IWORK(16) = IMXER<a name='379'>
C Set Y vector, T, and optional output. --------------------------------<a name='380'>
 580  CONTINUE<a name='381'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_4"> (N, RWORK(LYH), 1, Y, 1)<a name='382'>
      T = TN<a name='383'>
      RWORK(11) = HU<a name='384'>
      RWORK(12) = H<a name='385'>
      RWORK(13) = TN<a name='386'>
      IWORK(11) = NST<a name='387'>
      IWORK(12) = NFE<a name='388'>
      IWORK(13) = NJE<a name='389'>
      IWORK(14) = NQU<a name='390'>
      IWORK(15) = NQ<a name='391'>
      IWORK(19) = NLU<a name='392'>
      IWORK(20) = NNI<a name='393'>
      IWORK(21) = NCFN<a name='394'>
      IWORK(22) = NETF<a name='395'>
      RETURN<a name='396'>
C-----------------------------------------------------------------------<a name='397'>
C-----------------------------------------------------------------------<a name='398'>
 601  MSG = 'VODE--   ISTATE (=I1) illegal '<a name='399'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_16"> (MSG, 30, 1, 1, 1, ISTATE, 0, 0, ZERO, ZERO)<a name='400'>
      IF (ISTATE .LT. 0) GO TO 800<a name='401'>
      GO TO 700<a name='402'>
 602  MSG = 'VODE--   ITASK (=I1) illegal  '<a name='403'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_17"> (MSG, 30, 2, 1, 1, ITASK, 0, 0, ZERO, ZERO)<a name='404'>
      GO TO 700<a name='405'>
 603  MSG = 'VODE--   ISTATE .gt. 1 but VODE- not initialized  '<a name='406'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_18"> (MSG, 50, 3, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='407'>
      GO TO 700<a name='408'>
 604  MSG = 'VODE--   NEQ (=I1) .lt. 1     '<a name='409'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_19"> (MSG, 30, 4, 1, 1, NEQ, 0, 0, ZERO, ZERO)<a name='410'>
      GO TO 700<a name='411'>
 605  MSG = 'VODE--   ISTATE = 3 and NEQ increased (I1 to I2)  '<a name='412'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_20"> (MSG, 50, 5, 1, 2, N, NEQ, 0, ZERO, ZERO)<a name='413'>
      GO TO 700<a name='414'>
 606  MSG = 'VODE--   ITOL (=I1) illegal   '<a name='415'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_21"> (MSG, 30, 6, 1, 1, ITOL, 0, 0, ZERO, ZERO)<a name='416'>
      GO TO 700<a name='417'>
 607  MSG = 'VODE--   IOPT (=I1) illegal   '<a name='418'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_22"> (MSG, 30, 7, 1, 1, IOPT, 0, 0, ZERO, ZERO)<a name='419'>
      GO TO 700<a name='420'>
 608  MSG = 'VODE--   MF (=I1) illegal     '<a name='421'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_23"> (MSG, 30, 8, 1, 1, MF, 0, 0, ZERO, ZERO)<a name='422'>
      GO TO 700<a name='423'>
 609  MSG = 'VODE--   ML (=I1) illegal.. .lt.0 or .ge.NEQ (=I2)'<a name='424'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_24"> (MSG, 50, 9, 1, 2, ML, NEQ, 0, ZERO, ZERO)<a name='425'>
      GO TO 700<a name='426'>
 610  MSG = 'VODE--   MU (=I1) illegal.. .lt.0 or .ge.NEQ (=I2)'<a name='427'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_25"> (MSG, 50, 10, 1, 2, MU, NEQ, 0, ZERO, ZERO)<a name='428'>
      GO TO 700<a name='429'>
 611  MSG = 'VODE--   MAXORD (=I1) .lt. 0  '<a name='430'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_26"> (MSG, 30, 11, 1, 1, MAXORD, 0, 0, ZERO, ZERO)<a name='431'>
      GO TO 700<a name='432'>
 612  MSG = 'VODE--   MXSTEP (=I1) .lt. 0  '<a name='433'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_27"> (MSG, 30, 12, 1, 1, MXSTEP, 0, 0, ZERO, ZERO)<a name='434'>
      GO TO 700<a name='435'>
 613  MSG = 'VODE--   MXHNIL (=I1) .lt. 0  '<a name='436'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_28"> (MSG, 30, 13, 1, 1, MXHNIL, 0, 0, ZERO, ZERO)<a name='437'>
      GO TO 700<a name='438'>
 614  MSG = 'VODE--   TOUT (=R1) behind T (=R2)      '<a name='439'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_29"> (MSG, 40, 14, 1, 0, 0, 0, 2, TOUT, T)<a name='440'>
      MSG = '      integration direction is given by H0 (=R1)  '<a name='441'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_30"> (MSG, 50, 14, 1, 0, 0, 0, 1, H0, ZERO)<a name='442'>
      GO TO 700<a name='443'>
 615  MSG = 'VODE--   HMAX (=R1) .lt. 0.0  '<a name='444'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_31"> (MSG, 30, 15, 1, 0, 0, 0, 1, HMAX, ZERO)<a name='445'>
      GO TO 700<a name='446'>
 616  MSG = 'VODE--   HMIN (=R1) .lt. 0.0  '<a name='447'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_32"> (MSG, 30, 16, 1, 0, 0, 0, 1, HMIN, ZERO)<a name='448'>
      GO TO 700<a name='449'>
 617  CONTINUE<a name='450'>
      MSG='VODE--   RWORK length needed, LENRW (=I1), exceeds LRW (=I2)'<a name='451'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_33"> (MSG, 60, 17, 1, 2, LENRW, LRW, 0, ZERO, ZERO)<a name='452'>
      GO TO 700<a name='453'>
 618  CONTINUE<a name='454'>
      MSG='VODE--   IWORK length needed, LENIW (=I1), exceeds LIW (=I2)'<a name='455'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_34"> (MSG, 60, 18, 1, 2, LENIW, LIW, 0, ZERO, ZERO)<a name='456'>
      GO TO 700<a name='457'>
 619  MSG = 'VODE--   RTOL(I1) is R1 .lt. 0.0        '<a name='458'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_35"> (MSG, 40, 19, 1, 1, I, 0, 1, RTOLI, ZERO)<a name='459'>
      GO TO 700<a name='460'>
 620  MSG = 'VODE--   ATOL(I1) is R1 .lt. 0.0        '<a name='461'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_36"> (MSG, 40, 20, 1, 1, I, 0, 1, ATOLI, ZERO)<a name='462'>
      GO TO 700<a name='463'>
 621  EWTI = RWORK(LEWT+I-1)<a name='464'>
      MSG = 'VODE--   EWT(I1) is R1 .le. 0.0         '<a name='465'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_37"> (MSG, 40, 21, 1, 1, I, 0, 1, EWTI, ZERO)<a name='466'>
      GO TO 700<a name='467'>
 622  CONTINUE<a name='468'>
      MSG='VODE--   TOUT (=R1) too close to T(=R2) to start integration'<a name='469'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_38"> (MSG, 60, 22, 1, 0, 0, 0, 2, TOUT, T)<a name='470'>
      GO TO 700<a name='471'>
 623  CONTINUE<a name='472'>
      MSG='VODE--   ITASK = I1 and TOUT (=R1) behind TCUR - HU (= R2)  '<a name='473'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_39"> (MSG, 60, 23, 1, 1, ITASK, 0, 2, TOUT, TP)<a name='474'>
      GO TO 700<a name='475'>
 624  CONTINUE<a name='476'>
      MSG='VODE--   ITASK = 4 or 5 and TCRIT (=R1) behind TCUR (=R2)   '<a name='477'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_40"> (MSG, 60, 24, 1, 0, 0, 0, 2, TCRIT, TN)<a name='478'>
      GO TO 700<a name='479'>
 625  CONTINUE<a name='480'>
      MSG='VODE--   ITASK = 4 or 5 and TCRIT (=R1) behind TOUT (=R2)   '<a name='481'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_41"> (MSG, 60, 25, 1, 0, 0, 0, 2, TCRIT, TOUT)<a name='482'>
      GO TO 700<a name='483'>
 626  MSG = 'VODE--   At start of problem, too much accuracy   '<a name='484'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_42"> (MSG, 50, 26, 1, 0, 0, 0, 0, ZERO, ZERO)<a name='485'>
      MSG='      requested for precision of machine..  see TOLSF (=R1) '<a name='486'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_43"> (MSG, 60, 26, 1, 0, 0, 0, 1, TOLSF, ZERO)<a name='487'>
      RWORK(14) = TOLSF<a name='488'>
      GO TO 700<a name='489'>
 627  MSG = 'VODE--   Trouble from VINDY. ITASK = I1, TOUT = R1'<a name='490'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_44"> (MSG, 50, 27, 1, 1, ITASK, 0, 1, TOUT, ZERO)<a name='491'>
C<a name='492'>
 700  CONTINUE<a name='493'>
      ISTATE = -3<a name='494'>
      RETURN<a name='495'>
C<a name='496'>
 800  MSG = 'VODE--   Run aborted.. apparent infinite loop     '<a name='497'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#DVODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_45"> (MSG, 50, 303, 2, 0, 0, 0, 0, ZERO, ZERO)<a name='498'>
      RETURN<a name='499'>
C----------------------- End of Subroutine VODE ------------------------<a name='500'>
      END<a name='501'>
<A NAME='VHIN'><A href='../../html_code/CGEM_2.0/vode.f.html#VHIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='502'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VHIN</font> (N, T0, Y0, YDOT, F, RPAR, IPAR, TOUT, UROUND, <A href='../../call_to/VHIN.html' TARGET='index'>1</A>,<A href='../../call_from/VHIN.html' TARGET='index'>1</A><a name='503'>
     1   EWT, ITOL, ATOL, Y, TEMP, H0, NITER, IER)<a name='504'>
      EXTERNAL F<a name='505'>
      DOUBLE PRECISION T0, Y0, YDOT, RPAR, TOUT, UROUND, EWT, ATOL, Y,<a name='506'>
     1   TEMP, H0<a name='507'>
      INTEGER N, IPAR, ITOL, NITER, IER<a name='508'>
      DIMENSION Y0(*), YDOT(*), EWT(*), ATOL(*), Y(*),<a name='509'>
     1   TEMP(*), RPAR(*), IPAR(*)<a name='510'>
C-----------------------------------------------------------------------<a name='511'>
C<a name='512'>
      DOUBLE PRECISION AFI, ATOLI, DELYI, HALF, HG, HLB, HNEW, HRAT,<a name='513'>
     1     HUB, HUN, PT1, T1, TDIST, TROUND, TWO, VNORM, YDDNRM<a name='514'>
      INTEGER I, ITER<a name='515'>
C<a name='516'>
C-----------------------------------------------------------------------<a name='517'>
C-----------------------------------------------------------------------<a name='518'>
      SAVE HALF, HUN, PT1, TWO<a name='519'>
      DATA HALF /0.5D0/, HUN /100.0D0/, PT1 /0.1D0/, TWO /2.0D0/<a name='520'>
C<a name='521'>
      NITER = 0<a name='522'>
      TDIST = DABS(TOUT - T0)<a name='523'>
      TROUND = UROUND*DMAX1(DABS(T0),DABS(TOUT))<a name='524'>
      IF (TDIST .LT. TWO*TROUND) GO TO 100<a name='525'>
C<a name='526'>
C Set a lower bound on h based on the roundoff level in T0 and TOUT. ---<a name='527'>
      HLB = HUN*TROUND<a name='528'>
C Set an upper bound on h based on TOUT-T0 and the initial Y and YDOT. -<a name='529'>
      HUB = PT1*TDIST<a name='530'>
      ATOLI = ATOL(1)<a name='531'>
      DO 10 I = 1,N<a name='532'>
        IF (ITOL .EQ. 2 .OR. ITOL .EQ. 4) ATOLI = ATOL(I)<a name='533'>
        DELYI = PT1*DABS(Y0(I)) + ATOLI<a name='534'>
        AFI = DABS(YDOT(I))<a name='535'>
        IF (AFI*HUB .GT. DELYI) HUB = DELYI/AFI<a name='536'>
 10     CONTINUE<a name='537'>
C<a name='538'>
C Set initial guess for h as geometric mean of upper and lower bounds. -<a name='539'>
      ITER = 0<a name='540'>
      HG = DSQRT(HLB*HUB)<a name='541'>
C If the bounds have crossed, exit with the mean value. ----------------<a name='542'>
      IF (HUB .LT. HLB) THEN<a name='543'>
        H0 = HG<a name='544'>
        GO TO 90<a name='545'>
      ENDIF<a name='546'>
C<a name='547'>
C Looping point for iteration. -----------------------------------------<a name='548'>
 50   CONTINUE<a name='549'>
C Estimate the second derivative as a difference quotient in f. --------<a name='550'>
      T1 = T0 + HG<a name='551'>
      DO 60 I = 1,N<a name='552'>
 60     Y(I) = Y0(I) + HG*YDOT(I)<a name='553'>
      CALL F (N, T1, Y, TEMP, RPAR, IPAR)<a name='554'>
      DO 70 I = 1,N<a name='555'>
 70     TEMP(I) = (TEMP(I) - YDOT(I))/HG<a name='556'>
      YDDNRM = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VHIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_2"> (N, TEMP, EWT)<a name='557'>
C Get the corresponding new value of h. --------------------------------<a name='558'>
      IF (YDDNRM*HUB*HUB .GT. TWO) THEN<a name='559'>
        HNEW = DSQRT(TWO/YDDNRM)<a name='560'>
      ELSE<a name='561'>
        HNEW = DSQRT(HG*HUB)<a name='562'>
      ENDIF<a name='563'>
      ITER = ITER + 1<a name='564'>
C-----------------------------------------------------------------------<a name='565'>
C-----------------------------------------------------------------------<a name='566'>
      IF (ITER .GE. 4) GO TO 80<a name='567'>
      HRAT = HNEW/HG<a name='568'>
      IF ( (HRAT .GT. HALF) .AND. (HRAT .LT. TWO) ) GO TO 80<a name='569'>
      IF ( (ITER .GE. 2) .AND. (HNEW .GT. TWO*HG) ) THEN<a name='570'>
        HNEW = HG<a name='571'>
        GO TO 80<a name='572'>
      ENDIF<a name='573'>
      HG = HNEW<a name='574'>
      GO TO 50<a name='575'>
C<a name='576'>
C Iteration done.  Apply bounds, bias factor, and sign.  Then exit. ----<a name='577'>
 80   H0 = HNEW*HALF<a name='578'>
      IF (H0 .LT. HLB) H0 = HLB<a name='579'>
      IF (H0 .GT. HUB) H0 = HUB<a name='580'>
 90   H0 = DSIGN(H0, TOUT - T0)<a name='581'>
      NITER = ITER<a name='582'>
      IER = 0<a name='583'>
      RETURN<a name='584'>
C Error return for TOUT - T0 too small. --------------------------------<a name='585'>
 100  IER = -1<a name='586'>
      RETURN<a name='587'>
C----------------------- End of Subroutine VHIN ------------------------<a name='588'>
      END<a name='589'>
<A NAME='VINDY'><A href='../../html_code/CGEM_2.0/vode.f.html#VINDY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='590'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VINDY</font> (T, K, YH, LDYH, DKY, IFLAG) <A href='../../call_to/VINDY.html' TARGET='index'>4</A>,<A href='../../call_from/VINDY.html' TARGET='index'>4</A><a name='591'>
      DOUBLE PRECISION T, YH, DKY<a name='592'>
      INTEGER K, LDYH, IFLAG<a name='593'>
      DIMENSION YH(LDYH,*), DKY(*)<a name='594'>
C-----------------------------------------------------------------------<a name='595'>
C<a name='596'>
      DOUBLE PRECISION ACNRM, CCMXJ, CONP, CRATE, DRC, EL,<a name='597'>
     1     ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='598'>
     2     RC, RL1, TAU, TQ, TN, UROUND<a name='599'>
      INTEGER ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='600'>
     1        L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='601'>
     2        LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='602'>
     3        N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='603'>
     4        NSLP, NYH<a name='604'>
C<a name='605'>
C Type declarations for labeled COMMON block VOD002 --------------------<a name='606'>
C<a name='607'>
      DOUBLE PRECISION HU<a name='608'>
      INTEGER NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='609'>
C<a name='610'>
C Type declarations for local variables --------------------------------<a name='611'>
C<a name='612'>
      DOUBLE PRECISION C, HUN, R, S, TFUZZ, TN1, TP, ZERO<a name='613'>
      INTEGER I, IC, J, JB, JB2, JJ, JJ1, JP1<a name='614'>
      CHARACTER*80 MSG<a name='615'>
C-----------------------------------------------------------------------<a name='616'>
C-----------------------------------------------------------------------<a name='617'>
      SAVE HUN, ZERO<a name='618'>
C<a name='619'>
      COMMON /VOD001/ ACNRM, CCMXJ, CONP, CRATE, DRC, EL(13),<a name='620'>
     1                ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='621'>
     2                RC, RL1, TAU(13), TQ(5), TN, UROUND,<a name='622'>
     3                ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='623'>
     4                L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='624'>
     5                LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='625'>
     6                N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='626'>
     7                NSLP, NYH<a name='627'>
      COMMON /VOD002/ HU, NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='628'>
C<a name='629'>
      DATA HUN /100.0D0/, ZERO /0.0D0/<a name='630'>
C<a name='631'>
      IFLAG = 0<a name='632'>
      IF (K .LT. 0 .OR. K .GT. NQ) GO TO 80<a name='633'>
      TFUZZ = HUN*UROUND*(TN + HU)<a name='634'>
      TP = TN - HU - TFUZZ<a name='635'>
      TN1 = TN + TFUZZ<a name='636'>
      IF ((T-TP)*(T-TN1) .GT. ZERO) GO TO 90<a name='637'>
C<a name='638'>
      S = (T - TN)/H<a name='639'>
      IC = 1<a name='640'>
      IF (K .EQ. 0) GO TO 15<a name='641'>
      JJ1 = L - K<a name='642'>
      DO 10 JJ = JJ1,NQ<a name='643'>
 10     IC = IC*JJ<a name='644'>
 15   C = DFLOAT(IC)<a name='645'>
      DO 20 I = 1,N<a name='646'>
 20     DKY(I) = C*YH(I,L)<a name='647'>
      IF (K .EQ. NQ) GO TO 55<a name='648'>
      JB2 = NQ - K<a name='649'>
      DO 50 JB = 1,JB2<a name='650'>
        J = NQ - JB<a name='651'>
        JP1 = J + 1<a name='652'>
        IC = 1<a name='653'>
        IF (K .EQ. 0) GO TO 35<a name='654'>
        JJ1 = JP1 - K<a name='655'>
        DO 30 JJ = JJ1,J<a name='656'>
 30       IC = IC*JJ<a name='657'>
 35     C = DFLOAT(IC)<a name='658'>
        DO 40 I = 1,N<a name='659'>
 40       DKY(I) = C*YH(I,JP1) + S*DKY(I)<a name='660'>
 50     CONTINUE<a name='661'>
      IF (K .EQ. 0) RETURN<a name='662'>
 55   R = H**(-K)<a name='663'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL'>DSCAL</A><A href='../../html_code/CGEM_2.0/vode.f.html#VINDY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DSCAL_2"> (N, R, DKY, 1)<a name='664'>
      RETURN<a name='665'>
C<a name='666'>
 80   MSG = 'VINDY--  K (=I1) illegal      '<a name='667'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#VINDY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_46"> (MSG, 30, 51, 1, 1, K, 0, 0, ZERO, ZERO)<a name='668'>
      IFLAG = -1<a name='669'>
      RETURN<a name='670'>
 90   MSG = 'VINDY--  T (=R1) illegal      '<a name='671'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#VINDY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_47"> (MSG, 30, 52, 1, 0, 0, 0, 1, T, ZERO)<a name='672'>
      MSG='      T not in interval TCUR - HU (= R1) to TCUR (=R2)      '<a name='673'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV'>XERRWV</A><A href='../../html_code/CGEM_2.0/vode.f.html#VINDY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="XERRWV_48"> (MSG, 60, 52, 1, 0, 0, 0, 2, TP, TN)<a name='674'>
      IFLAG = -2<a name='675'>
      RETURN<a name='676'>
C----------------------- End of Subroutine VINDY -----------------------<a name='677'>
      END<a name='678'>
<A NAME='VSTEP'><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='679'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VSTEP</font> (Y, YH, LDYH, YH1, EWT, SAVF, VSAV, ACOR, <A href='../../call_to/VSTEP.html' TARGET='index'>1</A>,<A href='../../call_from/VSTEP.html' TARGET='index'>15</A><a name='680'>
     1                  WM, IWM, F, JAC, PSOL, VNLS, RPAR, IPAR)<a name='681'>
      EXTERNAL F, JAC, PSOL, VNLS<a name='682'>
      DOUBLE PRECISION Y, YH, YH1, EWT, SAVF, VSAV, ACOR, WM, RPAR<a name='683'>
      INTEGER LDYH, IWM, IPAR<a name='684'>
      DIMENSION Y(*), YH(LDYH,*), YH1(*), EWT(*), SAVF(*), VSAV(*),<a name='685'>
     1   ACOR(*), WM(*), IWM(*), RPAR(*), IPAR(*)<a name='686'>
C-----------------------------------------------------------------------<a name='687'>
C<a name='688'>
      DOUBLE PRECISION ACNRM, CCMXJ, CONP, CRATE, DRC, EL,<a name='689'>
     1     ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='690'>
     2     RC, RL1, TAU, TQ, TN, UROUND<a name='691'>
      INTEGER ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='692'>
     1        L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='693'>
     2        LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='694'>
     3        N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='695'>
     4        NSLP, NYH<a name='696'>
C<a name='697'>
C Type declarations for labeled COMMON block VOD002 --------------------<a name='698'>
C<a name='699'>
      DOUBLE PRECISION HU<a name='700'>
      INTEGER NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='701'>
C<a name='702'>
C Type declarations for local variables --------------------------------<a name='703'>
C<a name='704'>
      DOUBLE PRECISION ADDON, BIAS1,BIAS2,BIAS3, CNQUOT, DDN, DSM, DUP,<a name='705'>
     1     ETACF, ETAMIN, ETAMX1, ETAMX2, ETAMX3, ETAMXF,<a name='706'>
     2     ETAQ, ETAQM1, ETAQP1, FLOTL, ONE, ONEPSM,<a name='707'>
     3     R, THRESH, TOLD, VNORM, ZERO<a name='708'>
      INTEGER I, I1, I2, IBACK, J, JB, KFC, KFH, MXNCF, NCF, NFLAG<a name='709'>
C-----------------------------------------------------------------------<a name='710'>
C-----------------------------------------------------------------------<a name='711'>
      SAVE ADDON, BIAS1, BIAS2, BIAS3,<a name='712'>
     1     ETACF, ETAMIN, ETAMX1, ETAMX2, ETAMX3, ETAMXF,<a name='713'>
     2     KFC, KFH, MXNCF, ONEPSM, THRESH, ONE, ZERO<a name='714'>
C-----------------------------------------------------------------------<a name='715'>
      COMMON /VOD001/ ACNRM, CCMXJ, CONP, CRATE, DRC, EL(13),<a name='716'>
     1                ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='717'>
     2                RC, RL1, TAU(13), TQ(5), TN, UROUND,<a name='718'>
     3                ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='719'>
     4                L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='720'>
     5                LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='721'>
     6                N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='722'>
     7                NSLP, NYH<a name='723'>
      COMMON /VOD002/ HU, NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='724'>
C<a name='725'>
      DATA KFC/-3/, KFH/-7/, MXNCF/10/<a name='726'>
      DATA ADDON  /1.0D-6/,    BIAS1  /6.0D0/,     BIAS2  /6.0D0/,<a name='727'>
     1     BIAS3  /10.0D0/,    ETACF  /0.25D0/,    ETAMIN /0.1D0/,<a name='728'>
     2     ETAMXF /0.2D0/,     ETAMX1 /1.0D4/,     ETAMX2 /10.0D0/,<a name='729'>
     3     ETAMX3 /10.0D0/,    ONEPSM /1.00001D0/, THRESH /1.5D0/<a name='730'>
      DATA ONE/1.0D0/, ZERO/0.0D0/<a name='731'>
C<a name='732'>
      KFLAG = 0<a name='733'>
      TOLD = TN<a name='734'>
      NCF = 0<a name='735'>
      JCUR = 0<a name='736'>
      NFLAG = 0<a name='737'>
      IF (JSTART .GT. 0) GO TO 20<a name='738'>
      IF (JSTART .EQ. -1) GO TO 100<a name='739'>
C-----------------------------------------------------------------------<a name='740'>
C-----------------------------------------------------------------------<a name='741'>
      LMAX = MAXORD + 1<a name='742'>
      NQ = 1<a name='743'>
      L = 2<a name='744'>
      NQNYH = NQ*LDYH<a name='745'>
      TAU(1) = H<a name='746'>
      PRL1 = ONE<a name='747'>
      RC = ZERO<a name='748'>
      ETAMAX = ETAMX1<a name='749'>
      NQWAIT = 2<a name='750'>
      HSCAL = H<a name='751'>
      GO TO 200<a name='752'>
C-----------------------------------------------------------------------<a name='753'>
C-----------------------------------------------------------------------<a name='754'>
 20   CONTINUE<a name='755'>
      IF (KUTH .EQ. 1) THEN<a name='756'>
        ETA = DMIN1(ETA,H/HSCAL)<a name='757'>
        NEWH = 1<a name='758'>
        ENDIF<a name='759'>
 50   IF (NEWH .EQ. 0) GO TO 200<a name='760'>
      IF (NEWQ .EQ. NQ) GO TO 150<a name='761'>
      IF (NEWQ .LT. NQ) THEN<a name='762'>
        CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VJUST'>VJUST</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VJUST_1"> (YH, LDYH, -1)<a name='763'>
        NQ = NEWQ<a name='764'>
        L = NQ + 1<a name='765'>
        NQWAIT = L<a name='766'>
        GO TO 150<a name='767'>
        ENDIF<a name='768'>
      IF (NEWQ .GT. NQ) THEN<a name='769'>
        CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VJUST'>VJUST</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VJUST_2"> (YH, LDYH, 1)<a name='770'>
        NQ = NEWQ<a name='771'>
        L = NQ + 1<a name='772'>
        NQWAIT = L<a name='773'>
        GO TO 150<a name='774'>
      ENDIF<a name='775'>
C-----------------------------------------------------------------------<a name='776'>
C-----------------------------------------------------------------------<a name='777'>
 100  CONTINUE<a name='778'>
      LMAX = MAXORD + 1<a name='779'>
      IF (N .EQ. LDYH) GO TO 120<a name='780'>
      I1 = 1 + (NEWQ + 1)*LDYH<a name='781'>
      I2 = (MAXORD + 1)*LDYH<a name='782'>
      IF (I1 .GT. I2) GO TO 120<a name='783'>
      DO 110 I = I1,I2<a name='784'>
 110    YH1(I) = ZERO<a name='785'>
 120  IF (NEWQ .LE. MAXORD) GO TO 140<a name='786'>
      FLOTL = DFLOAT(LMAX)<a name='787'>
      IF (MAXORD .LT. NQ-1) THEN<a name='788'>
        DDN = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_3"> (N, SAVF, EWT)/TQ(1)<a name='789'>
        ETA = ONE/((BIAS1*DDN)**(ONE/FLOTL) + ADDON)<a name='790'>
        ENDIF<a name='791'>
      IF (MAXORD .EQ. NQ .AND. NEWQ .EQ. NQ+1) ETA = ETAQ<a name='792'>
      IF (MAXORD .EQ. NQ-1 .AND. NEWQ .EQ. NQ+1) THEN<a name='793'>
        ETA = ETAQM1<a name='794'>
        CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VJUST'>VJUST</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VJUST_3"> (YH, LDYH, -1)<a name='795'>
        ENDIF<a name='796'>
      IF (MAXORD .EQ. NQ-1 .AND. NEWQ .EQ. NQ) THEN<a name='797'>
        DDN = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_4"> (N, SAVF, EWT)/TQ(1)<a name='798'>
        ETA = ONE/((BIAS1*DDN)**(ONE/FLOTL) + ADDON)<a name='799'>
        CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VJUST'>VJUST</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VJUST_4"> (YH, LDYH, -1)<a name='800'>
        ENDIF<a name='801'>
      ETA = DMIN1(ETA,ONE)<a name='802'>
      NQ = MAXORD<a name='803'>
      L = LMAX<a name='804'>
 140  IF (KUTH .EQ. 1) ETA = DMIN1(ETA,DABS(H/HSCAL))<a name='805'>
      IF (KUTH .EQ. 0) ETA = DMAX1(ETA,HMIN/DABS(HSCAL))<a name='806'>
      ETA = ETA/DMAX1(ONE,DABS(HSCAL)*HMXI*ETA)<a name='807'>
      NEWH = 1<a name='808'>
      NQWAIT = L<a name='809'>
      IF (NEWQ .LE. MAXORD) GO TO 50<a name='810'>
C Rescale the history array for a change in H by a factor of ETA. ------<a name='811'>
 150  R = ONE<a name='812'>
      DO 180 J = 2,L<a name='813'>
        R = R*ETA<a name='814'>
        CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL'>DSCAL</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DSCAL_3"> (N, R, YH(1,J), 1 )<a name='815'>
 180    CONTINUE<a name='816'>
      H = HSCAL*ETA<a name='817'>
      HSCAL = H<a name='818'>
      RC = RC*ETA<a name='819'>
      NQNYH = NQ*LDYH<a name='820'>
C-----------------------------------------------------------------------<a name='821'>
C-----------------------------------------------------------------------<a name='822'>
 200  TN = TN + H<a name='823'>
      I1 = NQNYH + 1<a name='824'>
      DO 220 JB = 1,NQ<a name='825'>
        I1 = I1 - LDYH<a name='826'>
        DO 210 I = I1,NQNYH<a name='827'>
 210      YH1(I) = YH1(I) + YH1(I+LDYH)<a name='828'>
 220  CONTINUE<a name='829'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VSET'>VSET</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VSET_1"><a name='830'>
      RL1 = ONE/EL(2)<a name='831'>
      RC = RC*(RL1/PRL1)<a name='832'>
      PRL1 = RL1<a name='833'>
C<a name='834'>
C Call the nonlinear system solver. ------------------------------------<a name='835'>
C<a name='836'>
      CALL VNLS (Y, YH, LDYH, VSAV, SAVF, EWT, ACOR, IWM, WM,<a name='837'>
     1           F, JAC, PSOL, NFLAG, RPAR, IPAR)<a name='838'>
C<a name='839'>
      IF (NFLAG .EQ. 0) GO TO 450<a name='840'>
C-----------------------------------------------------------------------<a name='841'>
C-----------------------------------------------------------------------<a name='842'>
        NCF = NCF + 1<a name='843'>
        NCFN = NCFN + 1<a name='844'>
        ETAMAX = ONE<a name='845'>
        TN = TOLD<a name='846'>
        I1 = NQNYH + 1<a name='847'>
        DO 430 JB = 1,NQ<a name='848'>
          I1 = I1 - LDYH<a name='849'>
          DO 420 I = I1,NQNYH<a name='850'>
 420        YH1(I) = YH1(I) - YH1(I+LDYH)<a name='851'>
 430      CONTINUE<a name='852'>
        IF (NFLAG .LT. -1) GO TO 680<a name='853'>
        IF (DABS(H) .LE. HMIN*ONEPSM) GO TO 670<a name='854'>
        IF (NCF .EQ. MXNCF) GO TO 670<a name='855'>
        ETA = ETACF<a name='856'>
        ETA = DMAX1(ETA,HMIN/DABS(H))<a name='857'>
        NFLAG = -1<a name='858'>
        GO TO 150<a name='859'>
C-----------------------------------------------------------------------<a name='860'>
C-----------------------------------------------------------------------<a name='861'>
 450  CONTINUE<a name='862'>
      DSM = ACNRM/TQ(2)<a name='863'>
      IF (DSM .GT. ONE) GO TO 500<a name='864'>
C-----------------------------------------------------------------------<a name='865'>
C-----------------------------------------------------------------------<a name='866'>
      KFLAG = 0<a name='867'>
      NST = NST + 1<a name='868'>
      HU = H<a name='869'>
      NQU = NQ<a name='870'>
      DO 470 IBACK = 1,NQ<a name='871'>
        I = L - IBACK<a name='872'>
 470    TAU(I+1) = TAU(I)<a name='873'>
      TAU(1) = H<a name='874'>
      DO 480 J = 1,L<a name='875'>
        CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY'>DAXPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DAXPY_1"> (N, EL(J), ACOR, 1, YH(1,J), 1 )<a name='876'>
 480    CONTINUE<a name='877'>
      NQWAIT = NQWAIT - 1<a name='878'>
      IF ((L .EQ. LMAX) .OR. (NQWAIT .NE. 1)) GO TO 490<a name='879'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_5"> (N, ACOR, 1, YH(1,LMAX), 1 )<a name='880'>
      CONP = TQ(5)<a name='881'>
 490  IF (ETAMAX .NE. ONE) GO TO 560<a name='882'>
      IF (NQWAIT .LT. 2) NQWAIT = 2<a name='883'>
      NEWQ = NQ<a name='884'>
      NEWH = 0<a name='885'>
      ETA = ONE<a name='886'>
      HNEW = H<a name='887'>
      GO TO 690<a name='888'>
C-----------------------------------------------------------------------<a name='889'>
C-----------------------------------------------------------------------<a name='890'>
 500  KFLAG = KFLAG - 1<a name='891'>
      NETF = NETF + 1<a name='892'>
      NFLAG = -2<a name='893'>
      TN = TOLD<a name='894'>
      I1 = NQNYH + 1<a name='895'>
      DO 520 JB = 1,NQ<a name='896'>
        I1 = I1 - LDYH<a name='897'>
        DO 510 I = I1,NQNYH<a name='898'>
 510      YH1(I) = YH1(I) - YH1(I+LDYH)<a name='899'>
 520  CONTINUE<a name='900'>
      IF (DABS(H) .LE. HMIN*ONEPSM) GO TO 660<a name='901'>
      ETAMAX = ONE<a name='902'>
      IF (KFLAG .LE. KFC) GO TO 530<a name='903'>
C Compute ratio of new H to current H at the current order. ------------<a name='904'>
      FLOTL = DFLOAT(L)<a name='905'>
      ETA = ONE/((BIAS2*DSM)**(ONE/FLOTL) + ADDON)<a name='906'>
      ETA = DMAX1(ETA,HMIN/DABS(H),ETAMIN)<a name='907'>
      IF ((KFLAG .LE. -2) .AND. (ETA .GT. ETAMXF)) ETA = ETAMXF<a name='908'>
      GO TO 150<a name='909'>
C-----------------------------------------------------------------------<a name='910'>
C-----------------------------------------------------------------------<a name='911'>
 530  IF (KFLAG .EQ. KFH) GO TO 660<a name='912'>
      IF (NQ .EQ. 1) GO TO 540<a name='913'>
      ETA = DMAX1(ETAMIN,HMIN/DABS(H))<a name='914'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VJUST'>VJUST</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VJUST_5"> (YH, LDYH, -1)<a name='915'>
      L = NQ<a name='916'>
      NQ = NQ - 1<a name='917'>
      NQWAIT = L<a name='918'>
      GO TO 150<a name='919'>
 540  ETA = DMAX1(ETAMIN,HMIN/DABS(H))<a name='920'>
      H = H*ETA<a name='921'>
      HSCAL = H<a name='922'>
      TAU(1) = H<a name='923'>
      CALL F (N, TN, Y, SAVF, RPAR, IPAR)<a name='924'>
      NFE = NFE + 1<a name='925'>
      DO 550 I = 1,N<a name='926'>
 550    YH(I,2) = H*SAVF(I)<a name='927'>
      NQWAIT = 10<a name='928'>
      GO TO 200<a name='929'>
C-----------------------------------------------------------------------<a name='930'>
C-----------------------------------------------------------------------<a name='931'>
C Compute ratio of new H to current H at the current order. ------------<a name='932'>
 560  FLOTL = DFLOAT(L)<a name='933'>
      ETAQ = ONE/((BIAS2*DSM)**(ONE/FLOTL) + ADDON)<a name='934'>
      IF (NQWAIT .NE. 0) GO TO 600<a name='935'>
      NQWAIT = 2<a name='936'>
      ETAQM1 = ZERO<a name='937'>
      IF (NQ .EQ. 1) GO TO 570<a name='938'>
C Compute ratio of new H to current H at the current order less one. ---<a name='939'>
      DDN = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_5"> (N, YH(1,L), EWT)/TQ(1)<a name='940'>
      ETAQM1 = ONE/((BIAS1*DDN)**(ONE/(FLOTL - ONE)) + ADDON)<a name='941'>
 570  ETAQP1 = ZERO<a name='942'>
      IF (L .EQ. LMAX) GO TO 580<a name='943'>
C Compute ratio of new H to current H at current order plus one. -------<a name='944'>
      CNQUOT = (TQ(5)/CONP)*(H/TAU(2))**L<a name='945'>
      DO 575 I = 1,N<a name='946'>
 575    SAVF(I) = ACOR(I) - CNQUOT*YH(I,LMAX)<a name='947'>
      DUP = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_6"> (N, SAVF, EWT)/TQ(3)<a name='948'>
      ETAQP1 = ONE/((BIAS3*DUP)**(ONE/(FLOTL + ONE)) + ADDON)<a name='949'>
 580  IF (ETAQ .GE. ETAQP1) GO TO 590<a name='950'>
      IF (ETAQP1 .GT. ETAQM1) GO TO 620<a name='951'>
      GO TO 610<a name='952'>
 590  IF (ETAQ .LT. ETAQM1) GO TO 610<a name='953'>
 600  ETA = ETAQ<a name='954'>
      NEWQ = NQ<a name='955'>
      GO TO 630<a name='956'>
 610  ETA = ETAQM1<a name='957'>
      NEWQ = NQ - 1<a name='958'>
      GO TO 630<a name='959'>
 620  ETA = ETAQP1<a name='960'>
      NEWQ = NQ + 1<a name='961'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_6"> (N, ACOR, 1, YH(1,LMAX), 1)<a name='962'>
C Test tentative new H against THRESH, ETAMAX, and HMXI, then exit. ----<a name='963'>
 630  IF (ETA .LT. THRESH .OR. ETAMAX .EQ. ONE) GO TO 640<a name='964'>
      ETA = DMIN1(ETA,ETAMAX)<a name='965'>
      ETA = ETA/DMAX1(ONE,DABS(H)*HMXI*ETA)<a name='966'>
      NEWH = 1<a name='967'>
      HNEW = H*ETA<a name='968'>
      GO TO 690<a name='969'>
 640  NEWQ = NQ<a name='970'>
      NEWH = 0<a name='971'>
      ETA = ONE<a name='972'>
      HNEW = H<a name='973'>
      GO TO 690<a name='974'>
C-----------------------------------------------------------------------<a name='975'>
C-----------------------------------------------------------------------<a name='976'>
 660  KFLAG = -1<a name='977'>
      GO TO 720<a name='978'>
 670  KFLAG = -2<a name='979'>
      GO TO 720<a name='980'>
 680  IF (NFLAG .EQ. -2) KFLAG = -3<a name='981'>
      IF (NFLAG .EQ. -3) KFLAG = -4<a name='982'>
      GO TO 720<a name='983'>
 690  ETAMAX = ETAMX3<a name='984'>
      IF (NST .LE. 10) ETAMAX = ETAMX2<a name='985'>
 700  R = ONE/TQ(2)<a name='986'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL'>DSCAL</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DSCAL_4"> (N, R, ACOR, 1)<a name='987'>
 720  JSTART = 1<a name='988'>
      RETURN<a name='989'>
C----------------------- End of Subroutine VSTEP -----------------------<a name='990'>
      END<a name='991'>
<A NAME='VSET'><A href='../../html_code/CGEM_2.0/vode.f.html#VSET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='992'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VSET</font> <A href='../../call_to/VSET.html' TARGET='index'>1</A><a name='993'>
C-----------------------------------------------------------------------<a name='994'>
C<a name='995'>
      DOUBLE PRECISION ACNRM, CCMXJ, CONP, CRATE, DRC, EL,<a name='996'>
     1     ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='997'>
     2     RC, RL1, TAU, TQ, TN, UROUND<a name='998'>
      INTEGER ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='999'>
     1        L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1000'>
     2        LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1001'>
     3        N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1002'>
     4        NSLP, NYH<a name='1003'>
C<a name='1004'>
C Type declarations for local variables --------------------------------<a name='1005'>
C<a name='1006'>
      DOUBLE PRECISION AHATN0, ALPH0, CNQM1, CORTES, CSUM, ELP, EM,<a name='1007'>
     1     EM0, FLOTI, FLOTL, FLOTNQ, HSUM, ONE, RXI, RXIS, S, SIX,<a name='1008'>
     2     T1, T2, T3, T4, T5, T6, TWO, XI, ZERO<a name='1009'>
      INTEGER I, IBACK, J, JP1, NQM1, NQM2<a name='1010'>
C<a name='1011'>
      DIMENSION EM(13)<a name='1012'>
C-----------------------------------------------------------------------<a name='1013'>
C-----------------------------------------------------------------------<a name='1014'>
      SAVE CORTES, ONE, SIX, TWO, ZERO<a name='1015'>
C<a name='1016'>
      COMMON /VOD001/ ACNRM, CCMXJ, CONP, CRATE, DRC, EL(13),<a name='1017'>
     1                ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='1018'>
     2                RC, RL1, TAU(13), TQ(5), TN, UROUND,<a name='1019'>
     3                ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='1020'>
     4                L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1021'>
     5                LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1022'>
     6                N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1023'>
     7                NSLP, NYH<a name='1024'>
C<a name='1025'>
      DATA CORTES /0.1D0/<a name='1026'>
      DATA ONE  /1.0D0/, SIX /6.0D0/, TWO /2.0D0/, ZERO /0.0D0/<a name='1027'>
C<a name='1028'>
      FLOTL = DFLOAT(L)<a name='1029'>
      NQM1 = NQ - 1<a name='1030'>
      NQM2 = NQ - 2<a name='1031'>
      GO TO (100, 200), METH<a name='1032'>
C<a name='1033'>
C Set coefficients for Adams methods. ----------------------------------<a name='1034'>
 100  IF (NQ .NE. 1) GO TO 110<a name='1035'>
      EL(1) = ONE<a name='1036'>
      EL(2) = ONE<a name='1037'>
      TQ(1) = ONE<a name='1038'>
      TQ(2) = TWO<a name='1039'>
      TQ(3) = SIX*TQ(2)<a name='1040'>
      TQ(5) = ONE<a name='1041'>
      GO TO 300<a name='1042'>
 110  HSUM = H<a name='1043'>
      EM(1) = ONE<a name='1044'>
      FLOTNQ = FLOTL - ONE<a name='1045'>
      DO 115 I = 2,L<a name='1046'>
 115    EM(I) = ZERO<a name='1047'>
      DO 150 J = 1,NQM1<a name='1048'>
        IF ((J .NE. NQM1) .OR. (NQWAIT .NE. 1)) GO TO 130<a name='1049'>
        S = ONE<a name='1050'>
        CSUM = ZERO<a name='1051'>
        DO 120 I = 1,NQM1<a name='1052'>
          CSUM = CSUM + S*EM(I)/DFLOAT(I+1)<a name='1053'>
 120      S = -S<a name='1054'>
        TQ(1) = EM(NQM1)/(FLOTNQ*CSUM)<a name='1055'>
 130    RXI = H/HSUM<a name='1056'>
        DO 140 IBACK = 1,J<a name='1057'>
          I = (J + 2) - IBACK<a name='1058'>
 140      EM(I) = EM(I) + EM(I-1)*RXI<a name='1059'>
        HSUM = HSUM + TAU(J)<a name='1060'>
 150    CONTINUE<a name='1061'>
C Compute integral from -1 to 0 of polynomial and of x times it. -------<a name='1062'>
      S = ONE<a name='1063'>
      EM0 = ZERO<a name='1064'>
      CSUM = ZERO<a name='1065'>
      DO 160 I = 1,NQ<a name='1066'>
        FLOTI = DFLOAT(I)<a name='1067'>
        EM0 = EM0 + S*EM(I)/FLOTI<a name='1068'>
        CSUM = CSUM + S*EM(I)/(FLOTI+ONE)<a name='1069'>
 160    S = -S<a name='1070'>
C In EL, form coefficients of normalized integrated polynomial. --------<a name='1071'>
      S = ONE/EM0<a name='1072'>
      EL(1) = ONE<a name='1073'>
      DO 170 I = 1,NQ<a name='1074'>
 170    EL(I+1) = S*EM(I)/DFLOAT(I)<a name='1075'>
      XI = HSUM/H<a name='1076'>
      TQ(2) = XI*EM0/CSUM<a name='1077'>
      TQ(5) = XI/EL(L)<a name='1078'>
      IF (NQWAIT .NE. 1) GO TO 300<a name='1079'>
C For higher order control constant, multiply polynomial by 1+x/xi(q). -<a name='1080'>
      RXI = ONE/XI<a name='1081'>
      DO 180 IBACK = 1,NQ<a name='1082'>
        I = (L + 1) - IBACK<a name='1083'>
 180    EM(I) = EM(I) + EM(I-1)*RXI<a name='1084'>
C Compute integral of polynomial. --------------------------------------<a name='1085'>
      S = ONE<a name='1086'>
      CSUM = ZERO<a name='1087'>
      DO 190 I = 1,L<a name='1088'>
        CSUM = CSUM + S*EM(I)/DFLOAT(I+1)<a name='1089'>
 190    S = -S<a name='1090'>
      TQ(3) = FLOTL*EM0/CSUM<a name='1091'>
      GO TO 300<a name='1092'>
C<a name='1093'>
C Set coefficients for BDF methods. ------------------------------------<a name='1094'>
 200  DO 210 I = 3,L<a name='1095'>
 210    EL(I) = ZERO<a name='1096'>
      EL(1) = ONE<a name='1097'>
      EL(2) = ONE<a name='1098'>
      ALPH0 = -ONE<a name='1099'>
      AHATN0 = -ONE<a name='1100'>
      HSUM = H<a name='1101'>
      RXI = ONE<a name='1102'>
      RXIS = ONE<a name='1103'>
      IF (NQ .EQ. 1) GO TO 240<a name='1104'>
      DO 230 J = 1,NQM2<a name='1105'>
C In EL, construct coefficients of (1+x/xi(1))*...*(1+x/xi(j+1)). ------<a name='1106'>
        HSUM = HSUM + TAU(J)<a name='1107'>
        RXI = H/HSUM<a name='1108'>
        JP1 = J + 1<a name='1109'>
        ALPH0 = ALPH0 - ONE/DFLOAT(JP1)<a name='1110'>
        DO 220 IBACK = 1,JP1<a name='1111'>
          I = (J + 3) - IBACK<a name='1112'>
 220      EL(I) = EL(I) + EL(I-1)*RXI<a name='1113'>
 230    CONTINUE<a name='1114'>
      ALPH0 = ALPH0 - ONE/DFLOAT(NQ)<a name='1115'>
      RXIS = -EL(2) - ALPH0<a name='1116'>
      HSUM = HSUM + TAU(NQM1)<a name='1117'>
      RXI = H/HSUM<a name='1118'>
      AHATN0 = -EL(2) - RXI<a name='1119'>
      DO 235 IBACK = 1,NQ<a name='1120'>
        I = (NQ + 2) - IBACK<a name='1121'>
 235    EL(I) = EL(I) + EL(I-1)*RXIS<a name='1122'>
 240  T1 = ONE - AHATN0 + ALPH0<a name='1123'>
      T2 = ONE + DFLOAT(NQ)*T1<a name='1124'>
      TQ(2) = DABS(ALPH0*T2/T1)<a name='1125'>
      TQ(5) = DABS(T2/(EL(L)*RXI/RXIS))<a name='1126'>
      IF (NQWAIT .NE. 1) GO TO 300<a name='1127'>
      CNQM1 = RXIS/EL(L)<a name='1128'>
      T3 = ALPH0 + ONE/DFLOAT(NQ)<a name='1129'>
      T4 = AHATN0 + RXI<a name='1130'>
      ELP = T3/(ONE - T4 + T3)<a name='1131'>
      TQ(1) = DABS(ELP/CNQM1)<a name='1132'>
      HSUM = HSUM + TAU(NQ)<a name='1133'>
      RXI = H/HSUM<a name='1134'>
      T5 = ALPH0 - ONE/DFLOAT(NQ+1)<a name='1135'>
      T6 = AHATN0 - RXI<a name='1136'>
      ELP = T2/(ONE - T6 + T5)<a name='1137'>
      TQ(3) = DABS(ELP*RXI*(FLOTL + ONE)*T5)<a name='1138'>
 300  TQ(4) = CORTES*TQ(2)<a name='1139'>
      RETURN<a name='1140'>
C----------------------- End of Subroutine VSET ------------------------<a name='1141'>
      END<a name='1142'>
<A NAME='VJUST'><A href='../../html_code/CGEM_2.0/vode.f.html#VJUST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1143'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VJUST</font> (YH, LDYH, IORD) <A href='../../call_to/VJUST.html' TARGET='index'>5</A>,<A href='../../call_from/VJUST.html' TARGET='index'>1</A><a name='1144'>
      DOUBLE PRECISION YH<a name='1145'>
      INTEGER LDYH, IORD<a name='1146'>
      DIMENSION YH(LDYH,*)<a name='1147'>
C-----------------------------------------------------------------------<a name='1148'>
C<a name='1149'>
      DOUBLE PRECISION ACNRM, CCMXJ, CONP, CRATE, DRC, EL,<a name='1150'>
     1     ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='1151'>
     2     RC, RL1, TAU, TQ, TN, UROUND<a name='1152'>
      INTEGER ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='1153'>
     1        L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1154'>
     2        LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1155'>
     3        N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1156'>
     4        NSLP, NYH<a name='1157'>
C<a name='1158'>
C Type declarations for local variables --------------------------------<a name='1159'>
C<a name='1160'>
      DOUBLE PRECISION ALPH0,ALPH1, HSUM, ONE, PROD, T1, XI,XIOLD, ZERO<a name='1161'>
      INTEGER I, IBACK, J, JP1, LP1, NQM1, NQM2, NQP1<a name='1162'>
C-----------------------------------------------------------------------<a name='1163'>
C-----------------------------------------------------------------------<a name='1164'>
      SAVE ONE, ZERO<a name='1165'>
C<a name='1166'>
      COMMON /VOD001/ ACNRM, CCMXJ, CONP, CRATE, DRC, EL(13),<a name='1167'>
     1                ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='1168'>
     2                RC, RL1, TAU(13), TQ(5), TN, UROUND,<a name='1169'>
     3                ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='1170'>
     4                L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1171'>
     5                LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1172'>
     6                N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1173'>
     7                NSLP, NYH<a name='1174'>
C<a name='1175'>
      DATA ONE /1.0D0/, ZERO /0.0D0/<a name='1176'>
C<a name='1177'>
      IF ((NQ .EQ. 2) .AND. (IORD .NE. 1)) RETURN<a name='1178'>
      NQM1 = NQ - 1<a name='1179'>
      NQM2 = NQ - 2<a name='1180'>
      GO TO (100, 200), METH<a name='1181'>
C-----------------------------------------------------------------------<a name='1182'>
C-----------------------------------------------------------------------<a name='1183'>
 100  CONTINUE<a name='1184'>
      IF (IORD .EQ. 1) GO TO 180<a name='1185'>
C Order decrease. ------------------------------------------------------<a name='1186'>
      DO 110 J = 1,LMAX<a name='1187'>
 110    EL(J) = ZERO<a name='1188'>
      EL(2) = ONE<a name='1189'>
      HSUM = ZERO<a name='1190'>
      DO 130 J = 1,NQM2<a name='1191'>
C Construct coefficients of x*(x+xi(1))*...*(x+xi(j)). -----------------<a name='1192'>
        HSUM = HSUM + TAU(J)<a name='1193'>
        XI = HSUM/HSCAL<a name='1194'>
        JP1 = J + 1<a name='1195'>
        DO 120 IBACK = 1,JP1<a name='1196'>
          I = (J + 3) - IBACK<a name='1197'>
 120      EL(I) = EL(I)*XI + EL(I-1)<a name='1198'>
 130    CONTINUE<a name='1199'>
C Construct coefficients of integrated polynomial. ---------------------<a name='1200'>
      DO 140 J = 2,NQM1<a name='1201'>
 140    EL(J+1) = DFLOAT(NQ)*EL(J)/DFLOAT(J)<a name='1202'>
C Subtract correction terms from YH array. -----------------------------<a name='1203'>
      DO 170 J = 3,NQ<a name='1204'>
        DO 160 I = 1,N<a name='1205'>
 160      YH(I,J) = YH(I,J) - YH(I,L)*EL(J)<a name='1206'>
 170    CONTINUE<a name='1207'>
      RETURN<a name='1208'>
C Order increase. ------------------------------------------------------<a name='1209'>
C Zero out next column in YH array. ------------------------------------<a name='1210'>
 180  CONTINUE<a name='1211'>
      LP1 = L + 1<a name='1212'>
      DO 190 I = 1,N<a name='1213'>
 190    YH(I,LP1) = ZERO<a name='1214'>
      RETURN<a name='1215'>
C-----------------------------------------------------------------------<a name='1216'>
C Stiff option...<a name='1217'>
C Check to see if the order is being increased or decreased.<a name='1218'>
C-----------------------------------------------------------------------<a name='1219'>
 200  CONTINUE<a name='1220'>
      IF (IORD .EQ. 1) GO TO 300<a name='1221'>
C Order decrease. ------------------------------------------------------<a name='1222'>
      DO 210 J = 1,LMAX<a name='1223'>
 210    EL(J) = ZERO<a name='1224'>
      EL(3) = ONE<a name='1225'>
      HSUM = ZERO<a name='1226'>
      DO 230 J = 1,NQM2<a name='1227'>
C Construct coefficients of x*x*(x+xi(1))*...*(x+xi(j)). ---------------<a name='1228'>
        HSUM = HSUM + TAU(J)<a name='1229'>
        XI = HSUM/HSCAL<a name='1230'>
        JP1 = J + 1<a name='1231'>
        DO 220 IBACK = 1,JP1<a name='1232'>
          I = (J + 4) - IBACK<a name='1233'>
 220      EL(I) = EL(I)*XI + EL(I-1)<a name='1234'>
 230    CONTINUE<a name='1235'>
C Subtract correction terms from YH array. -----------------------------<a name='1236'>
      DO 250 J = 3,NQ<a name='1237'>
        DO 240 I = 1,N<a name='1238'>
 240      YH(I,J) = YH(I,J) - YH(I,L)*EL(J)<a name='1239'>
 250    CONTINUE<a name='1240'>
      RETURN<a name='1241'>
C Order increase. ------------------------------------------------------<a name='1242'>
 300  DO 310 J = 1,LMAX<a name='1243'>
 310    EL(J) = ZERO<a name='1244'>
      EL(3) = ONE<a name='1245'>
      ALPH0 = -ONE<a name='1246'>
      ALPH1 = ONE<a name='1247'>
      PROD = ONE<a name='1248'>
      XIOLD = ONE<a name='1249'>
      HSUM = HSCAL<a name='1250'>
      IF (NQ .EQ. 1) GO TO 340<a name='1251'>
      DO 330 J = 1,NQM1<a name='1252'>
C Construct coefficients of x*x*(x+xi(1))*...*(x+xi(j)). ---------------<a name='1253'>
        JP1 = J + 1<a name='1254'>
        HSUM = HSUM + TAU(JP1)<a name='1255'>
        XI = HSUM/HSCAL<a name='1256'>
        PROD = PROD*XI<a name='1257'>
        ALPH0 = ALPH0 - ONE/DFLOAT(JP1)<a name='1258'>
        ALPH1 = ALPH1 + ONE/XI<a name='1259'>
        DO 320 IBACK = 1,JP1<a name='1260'>
          I = (J + 4) - IBACK<a name='1261'>
 320      EL(I) = EL(I)*XIOLD + EL(I-1)<a name='1262'>
        XIOLD = XI<a name='1263'>
 330    CONTINUE<a name='1264'>
 340  CONTINUE<a name='1265'>
      T1 = (-ALPH0 - ALPH1)/PROD<a name='1266'>
C Load column L + 1 in YH array. ---------------------------------------<a name='1267'>
      LP1 = L + 1<a name='1268'>
      DO 350 I = 1,N<a name='1269'>
 350    YH(I,LP1) = T1*YH(I,LMAX)<a name='1270'>
C Add correction terms to YH array. ------------------------------------<a name='1271'>
      NQP1 = NQ + 1<a name='1272'>
      DO 370 J = 3,NQP1<a name='1273'>
        CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY'>DAXPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJUST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DAXPY_2"> (N, EL(J), YH(1,LP1), 1, YH(1,J), 1 )<a name='1274'>
 370  CONTINUE<a name='1275'>
      RETURN<a name='1276'>
C----------------------- End of Subroutine VJUST -----------------------<a name='1277'>
      END<a name='1278'>
<A NAME='VNLSD'><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1279'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VNLSD</font> (Y, YH, LDYH, VSAV, SAVF, EWT, ACOR, IWM, WM,,<A href='../../call_from/VNLSD.html' TARGET='index'>9</A><a name='1280'>
     1                 F, JAC, PDUM, NFLAG, RPAR, IPAR)<a name='1281'>
      EXTERNAL F, JAC, PDUM<a name='1282'>
      DOUBLE PRECISION Y, YH, VSAV, SAVF, EWT, ACOR, WM, RPAR<a name='1283'>
      INTEGER LDYH, IWM, NFLAG, IPAR<a name='1284'>
      DIMENSION Y(*), YH(LDYH,*), VSAV(*), SAVF(*), EWT(*), ACOR(*),<a name='1285'>
     1          IWM(*), WM(*), RPAR(*), IPAR(*)<a name='1286'>
C-----------------------------------------------------------------------<a name='1287'>
C<a name='1288'>
      DOUBLE PRECISION ACNRM, CCMXJ, CONP, CRATE, DRC, EL,<a name='1289'>
     1     ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='1290'>
     2     RC, RL1, TAU, TQ, TN, UROUND<a name='1291'>
      INTEGER ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='1292'>
     1        L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1293'>
     2        LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1294'>
     3        N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1295'>
     4        NSLP, NYH<a name='1296'>
C<a name='1297'>
C Type declarations for labeled COMMON block VOD002 --------------------<a name='1298'>
C<a name='1299'>
      DOUBLE PRECISION HU<a name='1300'>
      INTEGER NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='1301'>
C<a name='1302'>
C Type declarations for local variables --------------------------------<a name='1303'>
C<a name='1304'>
      DOUBLE PRECISION CCMAX, CRDOWN, CSCALE, DCON, DEL, DELP, ONE,<a name='1305'>
     1     RDIV, TWO, VNORM, ZERO<a name='1306'>
      INTEGER I, IERPJ, IERSL, M, MAXCOR, MSBP<a name='1307'>
C-----------------------------------------------------------------------<a name='1308'>
C-----------------------------------------------------------------------<a name='1309'>
      SAVE CCMAX, CRDOWN, MAXCOR, MSBP, RDIV, ONE, TWO, ZERO<a name='1310'>
C<a name='1311'>
      COMMON /VOD001/ ACNRM, CCMXJ, CONP, CRATE, DRC, EL(13),<a name='1312'>
     1                ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='1313'>
     2                RC, RL1, TAU(13), TQ(5), TN, UROUND,<a name='1314'>
     3                ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='1315'>
     4                L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1316'>
     5                LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1317'>
     6                N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1318'>
     7                NSLP, NYH<a name='1319'>
      COMMON /VOD002/ HU, NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='1320'>
C<a name='1321'>
      DATA CCMAX /0.3D0/, CRDOWN /0.3D0/, MAXCOR /3/, MSBP /20/,<a name='1322'>
     1     RDIV  /2.0D0/<a name='1323'>
      DATA ONE /1.0D0/, TWO /2.0D0/, ZERO /0.0D0/<a name='1324'>
C-----------------------------------------------------------------------<a name='1325'>
C-----------------------------------------------------------------------<a name='1326'>
      IF (JSTART .EQ. 0) NSLP = 0<a name='1327'>
      IF (NFLAG .EQ. 0) ICF = 0<a name='1328'>
      IF (NFLAG .EQ. -2) IPUP = MITER<a name='1329'>
      IF ( (JSTART .EQ. 0) .OR. (JSTART .EQ. -1) ) IPUP = MITER<a name='1330'>
C If this is functional iteration, set CRATE .eq. 1 and drop to 220<a name='1331'>
      IF (MITER .EQ. 0) THEN<a name='1332'>
        CRATE = ONE<a name='1333'>
        GO TO 220<a name='1334'>
      ENDIF<a name='1335'>
C-----------------------------------------------------------------------<a name='1336'>
C-----------------------------------------------------------------------<a name='1337'>
      DRC = DABS(RC-ONE)<a name='1338'>
      IF (DRC .GT. CCMAX .OR. NST .GE. NSLP+MSBP) IPUP = MITER<a name='1339'>
C-----------------------------------------------------------------------<a name='1340'>
C-----------------------------------------------------------------------<a name='1341'>
 220  M = 0<a name='1342'>
      DELP = ZERO<a name='1343'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_7"> (N, YH(1,1), 1, Y, 1 )<a name='1344'>
      CALL F (N, TN, Y, SAVF, RPAR, IPAR)<a name='1345'>
      NFE = NFE + 1<a name='1346'>
      IF (IPUP .LE. 0) GO TO 250<a name='1347'>
C-----------------------------------------------------------------------<a name='1348'>
C-----------------------------------------------------------------------<a name='1349'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VJAC'>VJAC</A><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VJAC_1"> (Y, YH, LDYH, EWT, ACOR, SAVF, WM, IWM, F, JAC, IERPJ,<a name='1350'>
     1           RPAR, IPAR)<a name='1351'>
      IPUP = 0<a name='1352'>
      RC = ONE<a name='1353'>
      DRC = ZERO<a name='1354'>
      CRATE = ONE<a name='1355'>
      NSLP = NST<a name='1356'>
C If matrix is singular, take error return to force cut in step size. --<a name='1357'>
      IF (IERPJ .NE. 0) GO TO 430<a name='1358'>
 250  DO 260 I = 1,N<a name='1359'>
 260    ACOR(I) = ZERO<a name='1360'>
C This is a looping point for the corrector iteration. -----------------<a name='1361'>
 270  IF (MITER .NE. 0) GO TO 350<a name='1362'>
C-----------------------------------------------------------------------<a name='1363'>
C-----------------------------------------------------------------------<a name='1364'>
      DO 280 I = 1,N<a name='1365'>
 280    SAVF(I) = RL1*(H*SAVF(I) - YH(I,2))<a name='1366'>
      DO 290 I = 1,N<a name='1367'>
 290    Y(I) = SAVF(I) - ACOR(I)<a name='1368'>
      DEL = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_7"> (N, Y, EWT)<a name='1369'>
      DO 300 I = 1,N<a name='1370'>
 300    Y(I) = YH(I,1) + SAVF(I)<a name='1371'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_8"> (N, SAVF, 1, ACOR, 1)<a name='1372'>
      GO TO 400<a name='1373'>
C-----------------------------------------------------------------------<a name='1374'>
C-----------------------------------------------------------------------<a name='1375'>
 350  DO 360 I = 1,N<a name='1376'>
 360    Y(I) = (RL1*H)*SAVF(I) - (RL1*YH(I,2) + ACOR(I))<a name='1377'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VSOL'>VSOL</A><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VSOL_1"> (WM, IWM, Y, IERSL)<a name='1378'>
      NNI = NNI + 1<a name='1379'>
      IF (IERSL .GT. 0) GO TO 410<a name='1380'>
      IF (METH .EQ. 2 .AND. RC .NE. ONE) THEN<a name='1381'>
        CSCALE = TWO/(ONE + RC)<a name='1382'>
        CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL'>DSCAL</A><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DSCAL_5"> (N, CSCALE, Y, 1)<a name='1383'>
      ENDIF<a name='1384'>
      DEL = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_8"> (N, Y, EWT)<a name='1385'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY'>DAXPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DAXPY_3"> (N, ONE, Y, 1, ACOR, 1)<a name='1386'>
      DO 380 I = 1,N<a name='1387'>
 380    Y(I) = YH(I,1) + ACOR(I)<a name='1388'>
C-----------------------------------------------------------------------<a name='1389'>
C-----------------------------------------------------------------------<a name='1390'>
 400  IF (M .NE. 0) CRATE = DMAX1(CRDOWN*CRATE,DEL/DELP)<a name='1391'>
      DCON = DEL*DMIN1(ONE,CRATE)/TQ(4)<a name='1392'>
      IF (DCON .LE. ONE) GO TO 450<a name='1393'>
      M = M + 1<a name='1394'>
      IF (M .EQ. MAXCOR) GO TO 410<a name='1395'>
      IF (M .GE. 2 .AND. DEL .GT. RDIV*DELP) GO TO 410<a name='1396'>
      DELP = DEL<a name='1397'>
      CALL F (N, TN, Y, SAVF, RPAR, IPAR)<a name='1398'>
      NFE = NFE + 1<a name='1399'>
      GO TO 270<a name='1400'>
C<a name='1401'>
 410  IF (MITER .EQ. 0 .OR. JCUR .EQ. 1) GO TO 430<a name='1402'>
      ICF = 1<a name='1403'>
      IPUP = MITER<a name='1404'>
      GO TO 220<a name='1405'>
C<a name='1406'>
 430  CONTINUE<a name='1407'>
      NFLAG = -1<a name='1408'>
      ICF = 2<a name='1409'>
      IPUP = MITER<a name='1410'>
      RETURN<a name='1411'>
C<a name='1412'>
C Return for successful step. ------------------------------------------<a name='1413'>
 450  NFLAG = 0<a name='1414'>
      JCUR = 0<a name='1415'>
      ICF = 0<a name='1416'>
      IF (M .EQ. 0) ACNRM = DEL<a name='1417'>
      IF (M .GT. 0) ACNRM = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VNLSD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_9"> (N, ACOR, EWT)<a name='1418'>
      RETURN<a name='1419'>
C----------------------- End of Subroutine VNLSD -----------------------<a name='1420'>
      END<a name='1421'>
<A NAME='VJAC'><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1422'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VJAC</font> (Y, YH, LDYH, EWT, FTEM, SAVF, WM, IWM, F, JAC, <A href='../../call_to/VJAC.html' TARGET='index'>1</A>,<A href='../../call_from/VJAC.html' TARGET='index'>12</A><a name='1423'>
     1                 IERPJ, RPAR, IPAR)<a name='1424'>
      EXTERNAL F, JAC<a name='1425'>
      INTEGER LDYH, IWM, IERPJ, IPAR<a name='1426'>
      DOUBLE PRECISION Y, YH, EWT, FTEM, SAVF, WM, RPAR<a name='1427'>
      DIMENSION Y(*), YH(LDYH,*), EWT(*), FTEM(*), SAVF(*),<a name='1428'>
     1   WM(*), IWM(*), RPAR(*), IPAR(*)<a name='1429'>
C-----------------------------------------------------------------------<a name='1430'>
C<a name='1431'>
      DOUBLE PRECISION ACNRM, CCMXJ, CONP, CRATE, DRC, EL,<a name='1432'>
     1     ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='1433'>
     2     RC, RL1, TAU, TQ, TN, UROUND<a name='1434'>
      INTEGER ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='1435'>
     1        L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1436'>
     2        LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1437'>
     3        N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1438'>
     4        NSLP, NYH<a name='1439'>
C<a name='1440'>
C Type declarations for labeled COMMON block VOD002 --------------------<a name='1441'>
C<a name='1442'>
      DOUBLE PRECISION HU<a name='1443'>
      INTEGER NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='1444'>
C<a name='1445'>
C Type declarations for local variables --------------------------------<a name='1446'>
C<a name='1447'>
      DOUBLE PRECISION CON, DI, FAC, HRL1, ONE, PT1, R, R0, SRUR, THOU,<a name='1448'>
     1     VNORM, YI, YJ, YJJ, ZERO<a name='1449'>
      INTEGER I, I1, I2, IER, II, J, J1, JJ, JOK, LENP, MBA, MBAND,<a name='1450'>
     1        MEB1, MEBAND, ML, ML3, MU, NP1<a name='1451'>
C-----------------------------------------------------------------------<a name='1452'>
C-----------------------------------------------------------------------<a name='1453'>
      SAVE ONE, PT1, THOU, ZERO<a name='1454'>
C-----------------------------------------------------------------------<a name='1455'>
      COMMON /VOD001/ ACNRM, CCMXJ, CONP, CRATE, DRC, EL(13),<a name='1456'>
     1                ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='1457'>
     2                RC, RL1, TAU(13), TQ(5), TN, UROUND,<a name='1458'>
     3                ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='1459'>
     4                L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1460'>
     5                LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1461'>
     6                N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1462'>
     7                NSLP, NYH<a name='1463'>
      COMMON /VOD002/ HU, NCFN, NETF, NFE, NJE, NLU, NNI, NQU, NST<a name='1464'>
C<a name='1465'>
      DATA ONE /1.0D0/, THOU /1000.0D0/, ZERO /0.0D0/, PT1 /0.1D0/<a name='1466'>
C<a name='1467'>
      IERPJ = 0<a name='1468'>
      HRL1 = H*RL1<a name='1469'>
C See whether J should be evaluated (JOK = -1) or not (JOK = 1). -------<a name='1470'>
      JOK = JSV<a name='1471'>
      IF (JSV .EQ. 1) THEN<a name='1472'>
        IF (NST .EQ. 0 .OR. NST .GT. NSLJ+MSBJ) JOK = -1<a name='1473'>
        IF (ICF .EQ. 1 .AND. DRC .LT. CCMXJ) JOK = -1<a name='1474'>
        IF (ICF .EQ. 2) JOK = -1<a name='1475'>
      ENDIF<a name='1476'>
C End of setting JOK. --------------------------------------------------<a name='1477'>
C<a name='1478'>
      IF (JOK .EQ. -1 .AND. MITER .EQ. 1) THEN<a name='1479'>
C If JOK = -1 and MITER = 1, call JAC to evaluate Jacobian. ------------<a name='1480'>
      NJE = NJE + 1<a name='1481'>
      NSLJ = NST<a name='1482'>
      JCUR = 1<a name='1483'>
      LENP = N*N<a name='1484'>
      DO 110 I = 1,LENP<a name='1485'>
 110    WM(I+2) = ZERO<a name='1486'>
      CALL JAC (N, TN, Y, 0, 0, WM(3), N, RPAR, IPAR)<a name='1487'>
      IF (JSV .EQ. 1) CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_9"> (LENP, WM(3), 1, WM(LOCJS), 1)<a name='1488'>
      ENDIF<a name='1489'>
C<a name='1490'>
      IF (JOK .EQ. -1 .AND. MITER .EQ. 2) THEN<a name='1491'>
C If MITER = 2, make N calls to F to approximate the Jacobian. ---------<a name='1492'>
      NJE = NJE + 1<a name='1493'>
      NSLJ = NST<a name='1494'>
      JCUR = 1<a name='1495'>
      FAC = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_10"> (N, SAVF, EWT)<a name='1496'>
      R0 = THOU*DABS(H)*UROUND*DFLOAT(N)*FAC<a name='1497'>
      IF (R0 .EQ. ZERO) R0 = ONE<a name='1498'>
      SRUR = WM(1)<a name='1499'>
      J1 = 2<a name='1500'>
      DO 230 J = 1,N<a name='1501'>
        YJ = Y(J)<a name='1502'>
        R = DMAX1(SRUR*DABS(YJ),R0/EWT(J))<a name='1503'>
        Y(J) = Y(J) + R<a name='1504'>
        FAC = ONE/R<a name='1505'>
        CALL F (N, TN, Y, FTEM, RPAR, IPAR)<a name='1506'>
        DO 220 I = 1,N<a name='1507'>
 220      WM(I+J1) = (FTEM(I) - SAVF(I))*FAC<a name='1508'>
        Y(J) = YJ<a name='1509'>
        J1 = J1 + N<a name='1510'>
 230    CONTINUE<a name='1511'>
      NFE = NFE + N<a name='1512'>
      LENP = N*N<a name='1513'>
      IF (JSV .EQ. 1) CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_10"> (LENP, WM(3), 1, WM(LOCJS), 1)<a name='1514'>
      ENDIF<a name='1515'>
C<a name='1516'>
      IF (JOK .EQ. 1 .AND. (MITER .EQ. 1 .OR. MITER .EQ. 2)) THEN<a name='1517'>
      JCUR = 0<a name='1518'>
      LENP = N*N<a name='1519'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_11"> (LENP, WM(LOCJS), 1, WM(3), 1)<a name='1520'>
      ENDIF<a name='1521'>
C<a name='1522'>
      IF (MITER .EQ. 1 .OR. MITER .EQ. 2) THEN<a name='1523'>
C Multiply Jacobian by scalar, add identity, and do LU decomposition. --<a name='1524'>
      CON = -HRL1<a name='1525'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL'>DSCAL</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DSCAL_6"> (LENP, CON, WM(3), 1)<a name='1526'>
      J = 3<a name='1527'>
      NP1 = N + 1<a name='1528'>
      DO 250 I = 1,N<a name='1529'>
        WM(J) = WM(J) + ONE<a name='1530'>
 250    J = J + NP1<a name='1531'>
      NLU = NLU + 1<a name='1532'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DGEFA'>DGEFA</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DGEFA_1"> (WM(3), N, N, IWM(31), IER)<a name='1533'>
      IF (IER .NE. 0) IERPJ = 1<a name='1534'>
      RETURN<a name='1535'>
      ENDIF<a name='1536'>
C End of code block for MITER = 1 or 2. --------------------------------<a name='1537'>
C<a name='1538'>
      IF (MITER .EQ. 3) THEN<a name='1539'>
C If MITER = 3, construct a diagonal approximation to J and P. ---------<a name='1540'>
      NJE = NJE + 1<a name='1541'>
      JCUR = 1<a name='1542'>
      WM(2) = HRL1<a name='1543'>
      R = RL1*PT1<a name='1544'>
      DO 310 I = 1,N<a name='1545'>
 310    Y(I) = Y(I) + R*(H*SAVF(I) - YH(I,2))<a name='1546'>
      CALL F (N, TN, Y, WM(3), RPAR, IPAR)<a name='1547'>
      NFE = NFE + 1<a name='1548'>
      DO 320 I = 1,N<a name='1549'>
        R0 = H*SAVF(I) - YH(I,2)<a name='1550'>
        DI = PT1*R0 - H*(WM(I+2) - SAVF(I))<a name='1551'>
        WM(I+2) = ONE<a name='1552'>
        IF (DABS(R0) .LT. UROUND/EWT(I)) GO TO 320<a name='1553'>
        IF (DABS(DI) .EQ. ZERO) GO TO 330<a name='1554'>
        WM(I+2) = PT1*R0/DI<a name='1555'>
 320    CONTINUE<a name='1556'>
      RETURN<a name='1557'>
 330  IERPJ = 1<a name='1558'>
      RETURN<a name='1559'>
      ENDIF<a name='1560'>
C End of code block for MITER = 3. -------------------------------------<a name='1561'>
C<a name='1562'>
C Set constants for MITER = 4 or 5. ------------------------------------<a name='1563'>
      ML = IWM(1)<a name='1564'>
      MU = IWM(2)<a name='1565'>
      ML3 = ML + 3<a name='1566'>
      MBAND = ML + MU + 1<a name='1567'>
      MEBAND = MBAND + ML<a name='1568'>
      LENP = MEBAND*N<a name='1569'>
C<a name='1570'>
      IF (JOK .EQ. -1 .AND. MITER .EQ. 4) THEN<a name='1571'>
C If JOK = -1 and MITER = 4, call JAC to evaluate Jacobian. ------------<a name='1572'>
      NJE = NJE + 1<a name='1573'>
      NSLJ = NST<a name='1574'>
      JCUR = 1<a name='1575'>
      DO 410 I = 1,LENP<a name='1576'>
 410    WM(I+2) = ZERO<a name='1577'>
      CALL JAC (N, TN, Y, ML, MU, WM(ML3), MEBAND, RPAR, IPAR)<a name='1578'>
      IF (JSV .EQ. 1)<a name='1579'>
     1   CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DACOPY'>DACOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DACOPY_1"> (MBAND, N, WM(ML3), MEBAND, WM(LOCJS), MBAND)<a name='1580'>
      ENDIF<a name='1581'>
C<a name='1582'>
      IF (JOK .EQ. -1 .AND. MITER .EQ. 5) THEN<a name='1583'>
C If MITER = 5, make N calls to F to approximate the Jacobian. ---------<a name='1584'>
      NJE = NJE + 1<a name='1585'>
      NSLJ = NST<a name='1586'>
      JCUR = 1<a name='1587'>
      MBA = MIN0(MBAND,N)<a name='1588'>
      MEB1 = MEBAND - 1<a name='1589'>
      SRUR = WM(1)<a name='1590'>
      FAC = <A href='../../html_code/CGEM_2.0/vode.f.html#VNORM'>VNORM</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VNORM_11"> (N, SAVF, EWT)<a name='1591'>
      R0 = THOU*DABS(H)*UROUND*DFLOAT(N)*FAC<a name='1592'>
      IF (R0 .EQ. ZERO) R0 = ONE<a name='1593'>
      DO 560 J = 1,MBA<a name='1594'>
        DO 530 I = J,N,MBAND<a name='1595'>
          YI = Y(I)<a name='1596'>
          R = DMAX1(SRUR*DABS(YI),R0/EWT(I))<a name='1597'>
 530      Y(I) = Y(I) + R<a name='1598'>
        CALL F (N, TN, Y, FTEM, RPAR, IPAR)<a name='1599'>
        DO 550 JJ = J,N,MBAND<a name='1600'>
          Y(JJ) = YH(JJ,1)<a name='1601'>
          YJJ = Y(JJ)<a name='1602'>
          R = DMAX1(SRUR*DABS(YJJ),R0/EWT(JJ))<a name='1603'>
          FAC = ONE/R<a name='1604'>
          I1 = MAX0(JJ-MU,1)<a name='1605'>
          I2 = MIN0(JJ+ML,N)<a name='1606'>
          II = JJ*MEB1 - ML + 2<a name='1607'>
          DO 540 I = I1,I2<a name='1608'>
 540        WM(II+I) = (FTEM(I) - SAVF(I))*FAC<a name='1609'>
 550      CONTINUE<a name='1610'>
 560    CONTINUE<a name='1611'>
      NFE = NFE + MBA<a name='1612'>
      IF (JSV .EQ. 1)<a name='1613'>
     1   CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DACOPY'>DACOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DACOPY_2"> (MBAND, N, WM(ML3), MEBAND, WM(LOCJS), MBAND)<a name='1614'>
      ENDIF<a name='1615'>
C<a name='1616'>
      IF (JOK .EQ. 1) THEN<a name='1617'>
      JCUR = 0<a name='1618'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DACOPY'>DACOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DACOPY_3"> (MBAND, N, WM(LOCJS), MBAND, WM(ML3), MEBAND)<a name='1619'>
      ENDIF<a name='1620'>
C<a name='1621'>
C Multiply Jacobian by scalar, add identity, and do LU decomposition.<a name='1622'>
      CON = -HRL1<a name='1623'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL'>DSCAL</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DSCAL_7"> (LENP, CON, WM(3), 1 )<a name='1624'>
      II = MBAND + 2<a name='1625'>
      DO 580 I = 1,N<a name='1626'>
        WM(II) = WM(II) + ONE<a name='1627'>
 580    II = II + MEBAND<a name='1628'>
      NLU = NLU + 1<a name='1629'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DGBFA'>DGBFA</A><A href='../../html_code/CGEM_2.0/vode.f.html#VJAC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DGBFA_1"> (WM(3), MEBAND, N, ML, MU, IWM(31), IER)<a name='1630'>
      IF (IER .NE. 0) IERPJ = 1<a name='1631'>
      RETURN<a name='1632'>
C End of code block for MITER = 4 or 5. --------------------------------<a name='1633'>
C<a name='1634'>
C----------------------- End of Subroutine VJAC ------------------------<a name='1635'>
      END<a name='1636'>
<A NAME='DACOPY'><A href='../../html_code/CGEM_2.0/vode.f.html#DACOPY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1637'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>DACOPY</font> (NROW, NCOL, A, NROWA, B, NROWB) <A href='../../call_to/DACOPY.html' TARGET='index'>3</A>,<A href='../../call_from/DACOPY.html' TARGET='index'>1</A><a name='1638'>
      DOUBLE PRECISION A, B<a name='1639'>
      INTEGER NROW, NCOL, NROWA, NROWB<a name='1640'>
      DIMENSION A(NROWA,NCOL), B(NROWB,NCOL)<a name='1641'>
C-----------------------------------------------------------------------<a name='1642'>
C-----------------------------------------------------------------------<a name='1643'>
      INTEGER IC<a name='1644'>
C<a name='1645'>
      DO 20 IC = 1,NCOL<a name='1646'>
        CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY'>DCOPY</A><A href='../../html_code/CGEM_2.0/vode.f.html#DACOPY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCOPY_12"> (NROW, A(1,IC), 1, B(1,IC), 1)<a name='1647'>
 20     CONTINUE<a name='1648'>
C<a name='1649'>
      RETURN<a name='1650'>
C----------------------- End of Subroutine DACOPY ----------------------<a name='1651'>
      END<a name='1652'>
<A NAME='VSOL'><A href='../../html_code/CGEM_2.0/vode.f.html#VSOL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1653'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VSOL</font> (WM, IWM, X, IERSL) <A href='../../call_to/VSOL.html' TARGET='index'>1</A>,<A href='../../call_from/VSOL.html' TARGET='index'>2</A><a name='1654'>
      DOUBLE PRECISION WM, X<a name='1655'>
      INTEGER IWM, IERSL<a name='1656'>
      DIMENSION WM(*), IWM(*), X(*)<a name='1657'>
C-----------------------------------------------------------------------<a name='1658'>
C<a name='1659'>
      DOUBLE PRECISION ACNRM, CCMXJ, CONP, CRATE, DRC, EL,<a name='1660'>
     1     ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='1661'>
     2     RC, RL1, TAU, TQ, TN, UROUND<a name='1662'>
      INTEGER ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='1663'>
     1        L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1664'>
     2        LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1665'>
     3        N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1666'>
     4        NSLP, NYH<a name='1667'>
C<a name='1668'>
C Type declarations for local variables --------------------------------<a name='1669'>
C<a name='1670'>
      INTEGER I, MEBAND, ML, MU<a name='1671'>
      DOUBLE PRECISION DI, HRL1, ONE, PHRL1, R, ZERO<a name='1672'>
C-----------------------------------------------------------------------<a name='1673'>
C-----------------------------------------------------------------------<a name='1674'>
      SAVE ONE, ZERO<a name='1675'>
C<a name='1676'>
      COMMON /VOD001/ ACNRM, CCMXJ, CONP, CRATE, DRC, EL(13),<a name='1677'>
     1                ETA, ETAMAX, H, HMIN, HMXI, HNEW, HSCAL, PRL1,<a name='1678'>
     2                RC, RL1, TAU(13), TQ(5), TN, UROUND,<a name='1679'>
     3                ICF, INIT, IPUP, JCUR, JSTART, JSV, KFLAG, KUTH,<a name='1680'>
     4                L, LMAX, LYH, LEWT, LACOR, LSAVF, LWM, LIWM,<a name='1681'>
     5                LOCJS, MAXORD, METH, MITER, MSBJ, MXHNIL, MXSTEP,<a name='1682'>
     6                N, NEWH, NEWQ, NHNIL, NQ, NQNYH, NQWAIT, NSLJ,<a name='1683'>
     7                NSLP, NYH<a name='1684'>
C<a name='1685'>
      DATA ONE /1.0D0/, ZERO /0.0D0/<a name='1686'>
C<a name='1687'>
      IERSL = 0<a name='1688'>
      GO TO (100, 100, 300, 400, 400), MITER<a name='1689'>
 100  CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DGESL'>DGESL</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DGESL_1"> (WM(3), N, N, IWM(31), X, 0)<a name='1690'>
      RETURN<a name='1691'>
C<a name='1692'>
 300  PHRL1 = WM(2)<a name='1693'>
      HRL1 = H*RL1<a name='1694'>
      WM(2) = HRL1<a name='1695'>
      IF (HRL1 .EQ. PHRL1) GO TO 330<a name='1696'>
      R = HRL1/PHRL1<a name='1697'>
      DO 320 I = 1,N<a name='1698'>
        DI = ONE - R*(ONE - ONE/WM(I+2))<a name='1699'>
        IF (DABS(DI) .EQ. ZERO) GO TO 390<a name='1700'>
 320    WM(I+2) = ONE/DI<a name='1701'>
C<a name='1702'>
 330  DO 340 I = 1,N<a name='1703'>
 340    X(I) = WM(I+2)*X(I)<a name='1704'>
      RETURN<a name='1705'>
 390  IERSL = 1<a name='1706'>
      RETURN<a name='1707'>
C<a name='1708'>
 400  ML = IWM(1)<a name='1709'>
      MU = IWM(2)<a name='1710'>
      MEBAND = 2*ML + MU + 1<a name='1711'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#DGBSL'>DGBSL</A><A href='../../html_code/CGEM_2.0/vode.f.html#VSOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DGBSL_1"> (WM(3), MEBAND, N, ML, MU, IWM(31), X, 0)<a name='1712'>
      RETURN<a name='1713'>
C----------------------- End of Subroutine VSOL ------------------------<a name='1714'>
      END<a name='1715'>
<A NAME='VSRCO'><A href='../../html_code/CGEM_2.0/vode.f.html#VSRCO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1716'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VSRCO</font> (RSAV, ISAV, JOB)<a name='1717'>
      INTEGER ISAV, JOB<a name='1718'>
      DOUBLE PRECISION RSAV<a name='1719'>
      DIMENSION RSAV(*), ISAV(*)<a name='1720'>
C-----------------------------------------------------------------------<a name='1721'>
C-----------------------------------------------------------------------<a name='1722'>
      DOUBLE PRECISION RVOD1, RVOD2<a name='1723'>
      INTEGER IVOD1, IVOD2<a name='1724'>
      INTEGER I, LENIV1, LENIV2, LENRV1, LENRV2<a name='1725'>
C-----------------------------------------------------------------------<a name='1726'>
C-----------------------------------------------------------------------<a name='1727'>
      SAVE LENRV1, LENIV1, LENRV2, LENIV2<a name='1728'>
C<a name='1729'>
      COMMON /VOD001/ RVOD1(48), IVOD1(33)<a name='1730'>
      COMMON /VOD002/ RVOD2(1), IVOD2(8)<a name='1731'>
      DATA LENRV1/48/, LENIV1/33/, LENRV2/1/, LENIV2/8/<a name='1732'>
C<a name='1733'>
      IF (JOB .EQ. 2) GO TO 100<a name='1734'>
      DO 10 I = 1,LENRV1<a name='1735'>
 10     RSAV(I) = RVOD1(I)<a name='1736'>
      DO 15 I = 1,LENRV2<a name='1737'>
 15     RSAV(LENRV1+I) = RVOD2(I)<a name='1738'>
C<a name='1739'>
      DO 20 I = 1,LENIV1<a name='1740'>
 20     ISAV(I) = IVOD1(I)<a name='1741'>
      DO 25 I = 1,LENIV2<a name='1742'>
 25     ISAV(LENIV1+I) = IVOD2(I)<a name='1743'>
C<a name='1744'>
      RETURN<a name='1745'>
C<a name='1746'>
 100  CONTINUE<a name='1747'>
      DO 110 I = 1,LENRV1<a name='1748'>
 110     RVOD1(I) = RSAV(I)<a name='1749'>
      DO 115 I = 1,LENRV2<a name='1750'>
 115     RVOD2(I) = RSAV(LENRV1+I)<a name='1751'>
C<a name='1752'>
      DO 120 I = 1,LENIV1<a name='1753'>
 120     IVOD1(I) = ISAV(I)<a name='1754'>
      DO 125 I = 1,LENIV2<a name='1755'>
 125     IVOD2(I) = ISAV(LENIV1+I)<a name='1756'>
C<a name='1757'>
      RETURN<a name='1758'>
C----------------------- End of Subroutine VSRCO -----------------------<a name='1759'>
      END<a name='1760'>
<A NAME='EWSET'><A href='../../html_code/CGEM_2.0/vode.f.html#EWSET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1761'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>EWSET</font> (N, ITOL, RTOL, ATOL, YCUR, EWT) <A href='../../call_to/EWSET.html' TARGET='index'>2</A><a name='1762'>
      INTEGER N, ITOL<a name='1763'>
      DOUBLE PRECISION RTOL, ATOL, YCUR, EWT<a name='1764'>
      DIMENSION RTOL(*), ATOL(*), YCUR(N), EWT(N)<a name='1765'>
C-----------------------------------------------------------------------<a name='1766'>
C-----------------------------------------------------------------------<a name='1767'>
      INTEGER I<a name='1768'>
C<a name='1769'>
      GO TO (10, 20, 30, 40), ITOL<a name='1770'>
 10   CONTINUE<a name='1771'>
      DO 15 I = 1,N<a name='1772'>
 15     EWT(I) = RTOL(1)*DABS(YCUR(I)) + ATOL(1)<a name='1773'>
      RETURN<a name='1774'>
 20   CONTINUE<a name='1775'>
      DO 25 I = 1,N<a name='1776'>
 25     EWT(I) = RTOL(1)*DABS(YCUR(I)) + ATOL(I)<a name='1777'>
      RETURN<a name='1778'>
 30   CONTINUE<a name='1779'>
      DO 35 I = 1,N<a name='1780'>
 35     EWT(I) = RTOL(I)*DABS(YCUR(I)) + ATOL(1)<a name='1781'>
      RETURN<a name='1782'>
 40   CONTINUE<a name='1783'>
      DO 45 I = 1,N<a name='1784'>
 45     EWT(I) = RTOL(I)*DABS(YCUR(I)) + ATOL(I)<a name='1785'>
      RETURN<a name='1786'>
C----------------------- End of Subroutine EWSET -----------------------<a name='1787'>
      END<a name='1788'>
<A NAME='VNORM'><A href='../../html_code/CGEM_2.0/vode.f.html#VNORM' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1789'>
      DOUBLE PRECISION <font color=#993300>FUNCTION </font><font color=#cc0000>VNORM</font> (N, V, W) <A href='../../call_to/VNORM.html' TARGET='index'>11</A><a name='1790'>
      INTEGER N<a name='1791'>
      DOUBLE PRECISION V, W<a name='1792'>
      DIMENSION V(N), W(N)<a name='1793'>
C-----------------------------------------------------------------------<a name='1794'>
C-----------------------------------------------------------------------<a name='1795'>
      INTEGER I<a name='1796'>
      DOUBLE PRECISION SUM<a name='1797'>
C<a name='1798'>
      SUM = 0.0D0<a name='1799'>
      DO 10 I = 1,N<a name='1800'>
 10     SUM = SUM + (V(I)*W(I))**2<a name='1801'>
      VNORM = DSQRT(SUM/DFLOAT(N))<a name='1802'>
      RETURN<a name='1803'>
C----------------------- End of Function VNORM -------------------------<a name='1804'>
      END<a name='1805'>
<A NAME='D1MACH'><A href='../../html_code/CGEM_2.0/vode.f.html#D1MACH' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1806'>
      DOUBLE PRECISION <font color=#993300>FUNCTION </font><font color=#cc0000>D1MACH</font> (IDUM) <A href='../../call_to/D1MACH.html' TARGET='index'>1</A><a name='1807'>
      INTEGER IDUM<a name='1808'>
C-----------------------------------------------------------------------<a name='1809'>
C-----------------------------------------------------------------------<a name='1810'>
      DOUBLE PRECISION U, COMP<a name='1811'>
      U = 1.0D0<a name='1812'>
 10   U = U*0.5D0<a name='1813'>
      COMP = 1.0D0 + U<a name='1814'>
      IF (COMP .NE. 1.0D0) GO TO 10<a name='1815'>
      D1MACH = U*2.0D0<a name='1816'>
      RETURN<a name='1817'>
C----------------------- End of Function D1MACH ------------------------<a name='1818'>
      END<a name='1819'>
<A NAME='XERRWV'><A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1820'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>XERRWV</font> (MSG, NMES, NERR, LEVEL, NI, I1, I2, NR, R1, R2) <A href='../../call_to/XERRWV.html' TARGET='index'>48</A>,<A href='../../call_from/XERRWV.html' TARGET='index'>2</A><a name='1821'>
      INTEGER NMES, NERR, LEVEL, NI, I1, I2, NR<a name='1822'>
      DOUBLE PRECISION R1, R2<a name='1823'>
      CHARACTER*1 MSG(NMES)<a name='1824'>
C-----------------------------------------------------------------------<a name='1825'>
C-----------------------------------------------------------------------<a name='1826'>
C<a name='1827'>
      INTEGER I, LUNIT, LUNSAV, MESFLG, MFLGSV<a name='1828'>
C<a name='1829'>
C Get message print flag and logical unit number. ----------------------<a name='1830'>
      MESFLG = <A href='../../html_code/CGEM_2.0/vode.f.html#MFLGSV'>MFLGSV</A><A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MFLGSV_1"> (0,.FALSE.)<a name='1831'>
      LUNIT = <A href='../../html_code/CGEM_2.0/vode.f.html#LUNSAV'>LUNSAV</A><A href='../../html_code/CGEM_2.0/vode.f.html#XERRWV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LUNSAV_1"> (0,.FALSE.)<a name='1832'>
      IF (MESFLG .EQ. 0) GO TO 100<a name='1833'>
C Write the message. ---------------------------------------------------<a name='1834'>
      WRITE (LUNIT,10) (MSG(I),I=1,NMES)<a name='1835'>
 10   FORMAT(1X,80A1)<a name='1836'>
      IF (NI .EQ. 1) WRITE (LUNIT, 20) I1<a name='1837'>
 20   FORMAT(6X,'In above message,  I1 =',I10)<a name='1838'>
      IF (NI .EQ. 2) WRITE (LUNIT, 30) I1,I2<a name='1839'>
 30   FORMAT(6X,'In above message,  I1 =',I10,3X,'I2 =',I10)<a name='1840'>
      IF (NR .EQ. 1) WRITE (LUNIT, 40) R1<a name='1841'>
 40   FORMAT(6X,'In above message,  R1 =',D21.13)<a name='1842'>
      IF (NR .EQ. 2) WRITE (LUNIT, 50) R1,R2<a name='1843'>
 50   FORMAT(6X,'In above,  R1 =',D21.13,3X,'R2 =',D21.13)<a name='1844'>
C Abort the run if LEVEL = 2. ------------------------------------------<a name='1845'>
 100  IF (LEVEL .NE. 2) RETURN<a name='1846'>
      STOP<a name='1847'>
C----------------------- End of Subroutine XERRWV ----------------------<a name='1848'>
      END<a name='1849'>
<A NAME='XSETF'><A href='../../html_code/CGEM_2.0/vode.f.html#XSETF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1850'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>XSETF</font> (MFLAG),<A href='../../call_from/XSETF.html' TARGET='index'>1</A><a name='1851'>
C-----------------------------------------------------------------------<a name='1852'>
C-----------------------------------------------------------------------<a name='1853'>
      INTEGER MFLAG, JUNK, MFLGSV<a name='1854'>
C<a name='1855'>
      IF (MFLAG .EQ. 0 .OR. MFLAG .EQ. 1) JUNK = <A href='../../html_code/CGEM_2.0/vode.f.html#MFLGSV'>MFLGSV</A><A href='../../html_code/CGEM_2.0/vode.f.html#XSETF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MFLGSV_2"> (MFLAG,.TRUE.)<a name='1856'>
      RETURN<a name='1857'>
C----------------------- End of Subroutine XSETF -----------------------<a name='1858'>
      END<a name='1859'>
<A NAME='XSETUN'><A href='../../html_code/CGEM_2.0/vode.f.html#XSETUN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1860'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>XSETUN</font> (LUN),<A href='../../call_from/XSETUN.html' TARGET='index'>1</A><a name='1861'>
C-----------------------------------------------------------------------<a name='1862'>
C-----------------------------------------------------------------------<a name='1863'>
      INTEGER LUN, JUNK, LUNSAV<a name='1864'>
C<a name='1865'>
      IF (LUN .GT. 0) JUNK = <A href='../../html_code/CGEM_2.0/vode.f.html#LUNSAV'>LUNSAV</A><A href='../../html_code/CGEM_2.0/vode.f.html#XSETUN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LUNSAV_2"> (LUN,.TRUE.)<a name='1866'>
      RETURN<a name='1867'>
C----------------------- End of Subroutine XSETUN ----------------------<a name='1868'>
      END<a name='1869'>
<A NAME='MFLGSV'><A href='../../html_code/CGEM_2.0/vode.f.html#MFLGSV' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1870'>
      INTEGER <font color=#993300>FUNCTION </font><font color=#cc0000>MFLGSV</font> (IVALUE, ISET) <A href='../../call_to/MFLGSV.html' TARGET='index'>2</A><a name='1871'>
      LOGICAL ISET<a name='1872'>
      INTEGER IVALUE<a name='1873'>
C-----------------------------------------------------------------------<a name='1874'>
C-----------------------------------------------------------------------<a name='1875'>
      INTEGER MESFLG<a name='1876'>
C-----------------------------------------------------------------------<a name='1877'>
C-----------------------------------------------------------------------<a name='1878'>
      SAVE MESFLG<a name='1879'>
      DATA MESFLG/1/<a name='1880'>
C<a name='1881'>
      MFLGSV = MESFLG<a name='1882'>
      IF (ISET) MESFLG = IVALUE<a name='1883'>
      RETURN<a name='1884'>
C----------------------- End of Function MFLGSV ------------------------<a name='1885'>
      END<a name='1886'>
<A NAME='LUNSAV'><A href='../../html_code/CGEM_2.0/vode.f.html#LUNSAV' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1887'>
      INTEGER <font color=#993300>FUNCTION </font><font color=#cc0000>LUNSAV</font> (IVALUE, ISET) <A href='../../call_to/LUNSAV.html' TARGET='index'>2</A><a name='1888'>
      LOGICAL ISET<a name='1889'>
      INTEGER IVALUE<a name='1890'>
C-----------------------------------------------------------------------<a name='1891'>
C-----------------------------------------------------------------------<a name='1892'>
      INTEGER LUNIT<a name='1893'>
C-----------------------------------------------------------------------<a name='1894'>
C-----------------------------------------------------------------------<a name='1895'>
      SAVE LUNIT<a name='1896'>
      DATA LUNIT/9/<a name='1897'>
C<a name='1898'>
      LUNSAV = LUNIT<a name='1899'>
      IF (ISET) LUNIT = IVALUE<a name='1900'>
      RETURN<a name='1901'>
C----------------------- End of Function LUNSAV ------------------------<a name='1902'>
      END<a name='1903'>
C<a name='1904'>
C<a name='1905'>
C<a name='1906'>
<A NAME='DGEFA'><A href='../../html_code/CGEM_2.0/vode.f.html#DGEFA' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1907'>
      <font color=#993300>subroutine </font><font color=#cc0000>dgefa</font>(a,lda,n,ipvt,info) <A href='../../call_to/DGEFA.html' TARGET='index'>1</A>,<A href='../../call_from/DGEFA.html' TARGET='index'>3</A><a name='1908'>
      integer lda,n,ipvt(1),info<a name='1909'>
      double precision a(lda,1)<a name='1910'>
c<a name='1911'>
c     dgefa factors a double precision matrix by gaussian elimination.<a name='1912'>
c<a name='1913'>
c<a name='1914'>
      double precision t<a name='1915'>
      integer idamax,j,k,kp1,l,nm1<a name='1916'>
c<a name='1917'>
c<a name='1918'>
c     gaussian elimination with partial pivoting<a name='1919'>
c<a name='1920'>
      info = 0<a name='1921'>
      nm1 = n - 1<a name='1922'>
      if (nm1 .lt. 1) go to 70<a name='1923'>
      do 60 k = 1, nm1<a name='1924'>
         kp1 = k + 1<a name='1925'>
c<a name='1926'>
c        find l = pivot index<a name='1927'>
c<a name='1928'>
         l = <A href='../../html_code/CGEM_2.0/vode.f.html#IDAMAX'>idamax</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGEFA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="IDAMAX_1">(n-k+1,a(k,k),1) + k - 1<a name='1929'>
         ipvt(k) = l<a name='1930'>
c<a name='1931'>
c        zero pivot implies this column already triangularized<a name='1932'>
c<a name='1933'>
         if (a(l,k) .eq. 0.0d0) go to 40<a name='1934'>
c<a name='1935'>
c           interchange if necessary<a name='1936'>
c<a name='1937'>
            if (l .eq. k) go to 10<a name='1938'>
               t = a(l,k)<a name='1939'>
               a(l,k) = a(k,k)<a name='1940'>
               a(k,k) = t<a name='1941'>
   10       continue<a name='1942'>
c<a name='1943'>
c           compute multipliers<a name='1944'>
c<a name='1945'>
            t = -1.0d0/a(k,k)<a name='1946'>
            call <A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL'>dscal</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGEFA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DSCAL_8">(n-k,t,a(k+1,k),1)<a name='1947'>
c<a name='1948'>
c           row elimination with column indexing<a name='1949'>
c<a name='1950'>
            do 30 j = kp1, n<a name='1951'>
               t = a(l,j)<a name='1952'>
               if (l .eq. k) go to 20<a name='1953'>
                  a(l,j) = a(k,j)<a name='1954'>
                  a(k,j) = t<a name='1955'>
   20          continue<a name='1956'>
               call <A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY'>daxpy</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGEFA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DAXPY_4">(n-k,t,a(k+1,k),1,a(k+1,j),1)<a name='1957'>
   30       continue<a name='1958'>
         go to 50<a name='1959'>
   40    continue<a name='1960'>
            info = k<a name='1961'>
   50    continue<a name='1962'>
   60 continue<a name='1963'>
   70 continue<a name='1964'>
      ipvt(n) = n<a name='1965'>
      if (a(n,n) .eq. 0.0d0) info = n<a name='1966'>
      return<a name='1967'>
      end<a name='1968'>
<A NAME='DGESL'><A href='../../html_code/CGEM_2.0/vode.f.html#DGESL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1969'>
      <font color=#993300>subroutine </font><font color=#cc0000>dgesl</font>(a,lda,n,ipvt,b,job) <A href='../../call_to/DGESL.html' TARGET='index'>1</A>,<A href='../../call_from/DGESL.html' TARGET='index'>4</A><a name='1970'>
      integer lda,n,ipvt(1),job<a name='1971'>
      double precision a(lda,1),b(1)<a name='1972'>
c<a name='1973'>
c     dgesl solves the double precision system<a name='1974'>
c     a * x = b  or  trans(a) * x = b<a name='1975'>
c     using the factors computed by dgeco or dgefa.<a name='1976'>
c<a name='1977'>
c<a name='1978'>
      double precision ddot,t<a name='1979'>
      integer k,kb,l,nm1<a name='1980'>
c<a name='1981'>
      nm1 = n - 1<a name='1982'>
      if (job .ne. 0) go to 50<a name='1983'>
c<a name='1984'>
c        job = 0 , solve  a * x = b<a name='1985'>
c        first solve  l*y = b<a name='1986'>
c<a name='1987'>
         if (nm1 .lt. 1) go to 30<a name='1988'>
         do 20 k = 1, nm1<a name='1989'>
            l = ipvt(k)<a name='1990'>
            t = b(l)<a name='1991'>
            if (l .eq. k) go to 10<a name='1992'>
               b(l) = b(k)<a name='1993'>
               b(k) = t<a name='1994'>
   10       continue<a name='1995'>
            call <A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY'>daxpy</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGESL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DAXPY_5">(n-k,t,a(k+1,k),1,b(k+1),1)<a name='1996'>
   20    continue<a name='1997'>
   30    continue<a name='1998'>
c<a name='1999'>
c        now solve  u*x = y<a name='2000'>
c<a name='2001'>
         do 40 kb = 1, n<a name='2002'>
            k = n + 1 - kb<a name='2003'>
            b(k) = b(k)/a(k,k)<a name='2004'>
            t = -b(k)<a name='2005'>
            call <A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY'>daxpy</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGESL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DAXPY_6">(k-1,t,a(1,k),1,b(1),1)<a name='2006'>
   40    continue<a name='2007'>
      go to 100<a name='2008'>
   50 continue<a name='2009'>
c<a name='2010'>
c        job = nonzero, solve  trans(a) * x = b<a name='2011'>
c        first solve  trans(u)*y = b<a name='2012'>
c<a name='2013'>
         do 60 k = 1, n<a name='2014'>
            t = <A href='../../html_code/CGEM_2.0/vode.f.html#DDOT'>ddot</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGESL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DDOT_1">(k-1,a(1,k),1,b(1),1)<a name='2015'>
            b(k) = (b(k) - t)/a(k,k)<a name='2016'>
   60    continue<a name='2017'>
c<a name='2018'>
c        now solve trans(l)*x = y<a name='2019'>
c<a name='2020'>
         if (nm1 .lt. 1) go to 90<a name='2021'>
         do 80 kb = 1, nm1<a name='2022'>
            k = n - kb<a name='2023'>
            b(k) = b(k) + <A href='../../html_code/CGEM_2.0/vode.f.html#DDOT'>ddot</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGESL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DDOT_2">(n-k,a(k+1,k),1,b(k+1),1)<a name='2024'>
            l = ipvt(k)<a name='2025'>
            if (l .eq. k) go to 70<a name='2026'>
               t = b(l)<a name='2027'>
               b(l) = b(k)<a name='2028'>
               b(k) = t<a name='2029'>
   70       continue<a name='2030'>
   80    continue<a name='2031'>
   90    continue<a name='2032'>
  100 continue<a name='2033'>
      return<a name='2034'>
      end<a name='2035'>
<A NAME='DGBFA'><A href='../../html_code/CGEM_2.0/vode.f.html#DGBFA' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2036'>
      <font color=#993300>subroutine </font><font color=#cc0000>dgbfa</font>(abd,lda,n,ml,mu,ipvt,info) <A href='../../call_to/DGBFA.html' TARGET='index'>1</A>,<A href='../../call_from/DGBFA.html' TARGET='index'>3</A><a name='2037'>
      integer lda,n,ml,mu,ipvt(1),info<a name='2038'>
      double precision abd(lda,1)<a name='2039'>
c<a name='2040'>
c     dgbfa factors a double precision band matrix by elimination.<a name='2041'>
c<a name='2042'>
c<a name='2043'>
      double precision t<a name='2044'>
      integer i,idamax,i0,j,ju,jz,j0,j1,k,kp1,l,lm,m,mm,nm1<a name='2045'>
c<a name='2046'>
c<a name='2047'>
      m = ml + mu + 1<a name='2048'>
      info = 0<a name='2049'>
c<a name='2050'>
c     zero initial fill-in columns<a name='2051'>
c<a name='2052'>
      j0 = mu + 2<a name='2053'>
      j1 = min0(n,m) - 1<a name='2054'>
      if (j1 .lt. j0) go to 30<a name='2055'>
      do 20 jz = j0, j1<a name='2056'>
         i0 = m + 1 - jz<a name='2057'>
         do 10 i = i0, ml<a name='2058'>
            abd(i,jz) = 0.0d0<a name='2059'>
   10    continue<a name='2060'>
   20 continue<a name='2061'>
   30 continue<a name='2062'>
      jz = j1<a name='2063'>
      ju = 0<a name='2064'>
c<a name='2065'>
c     gaussian elimination with partial pivoting<a name='2066'>
c<a name='2067'>
      nm1 = n - 1<a name='2068'>
      if (nm1 .lt. 1) go to 130<a name='2069'>
      do 120 k = 1, nm1<a name='2070'>
         kp1 = k + 1<a name='2071'>
c<a name='2072'>
c        zero next fill-in column<a name='2073'>
c<a name='2074'>
         jz = jz + 1<a name='2075'>
         if (jz .gt. n) go to 50<a name='2076'>
         if (ml .lt. 1) go to 50<a name='2077'>
            do 40 i = 1, ml<a name='2078'>
               abd(i,jz) = 0.0d0<a name='2079'>
   40       continue<a name='2080'>
   50    continue<a name='2081'>
c<a name='2082'>
c        find l = pivot index<a name='2083'>
c<a name='2084'>
         lm = min0(ml,n-k)<a name='2085'>
         l = <A href='../../html_code/CGEM_2.0/vode.f.html#IDAMAX'>idamax</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGBFA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="IDAMAX_2">(lm+1,abd(m,k),1) + m - 1<a name='2086'>
         ipvt(k) = l + k - m<a name='2087'>
c<a name='2088'>
c        zero pivot implies this column already triangularized<a name='2089'>
c<a name='2090'>
         if (abd(l,k) .eq. 0.0d0) go to 100<a name='2091'>
c<a name='2092'>
c           interchange if necessary<a name='2093'>
c<a name='2094'>
            if (l .eq. m) go to 60<a name='2095'>
               t = abd(l,k)<a name='2096'>
               abd(l,k) = abd(m,k)<a name='2097'>
               abd(m,k) = t<a name='2098'>
   60       continue<a name='2099'>
c<a name='2100'>
c           compute multipliers<a name='2101'>
c<a name='2102'>
            t = -1.0d0/abd(m,k)<a name='2103'>
            call <A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL'>dscal</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGBFA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DSCAL_9">(lm,t,abd(m+1,k),1)<a name='2104'>
c<a name='2105'>
c           row elimination with column indexing<a name='2106'>
c<a name='2107'>
            ju = min0(max0(ju,mu+ipvt(k)),n)<a name='2108'>
            mm = m<a name='2109'>
            if (ju .lt. kp1) go to 90<a name='2110'>
            do 80 j = kp1, ju<a name='2111'>
               l = l - 1<a name='2112'>
               mm = mm - 1<a name='2113'>
               t = abd(l,j)<a name='2114'>
               if (l .eq. mm) go to 70<a name='2115'>
                  abd(l,j) = abd(mm,j)<a name='2116'>
                  abd(mm,j) = t<a name='2117'>
   70          continue<a name='2118'>
               call <A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY'>daxpy</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGBFA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DAXPY_7">(lm,t,abd(m+1,k),1,abd(mm+1,j),1)<a name='2119'>
   80       continue<a name='2120'>
   90       continue<a name='2121'>
         go to 110<a name='2122'>
  100    continue<a name='2123'>
            info = k<a name='2124'>
  110    continue<a name='2125'>
  120 continue<a name='2126'>
  130 continue<a name='2127'>
      ipvt(n) = n<a name='2128'>
      if (abd(m,n) .eq. 0.0d0) info = n<a name='2129'>
      return<a name='2130'>
      end<a name='2131'>
<A NAME='DGBSL'><A href='../../html_code/CGEM_2.0/vode.f.html#DGBSL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2132'>
      <font color=#993300>subroutine </font><font color=#cc0000>dgbsl</font>(abd,lda,n,ml,mu,ipvt,b,job) <A href='../../call_to/DGBSL.html' TARGET='index'>1</A>,<A href='../../call_from/DGBSL.html' TARGET='index'>4</A><a name='2133'>
      integer lda,n,ml,mu,ipvt(1),job<a name='2134'>
      double precision abd(lda,1),b(1)<a name='2135'>
c<a name='2136'>
c     dgbsl solves the double precision band system<a name='2137'>
c     a * x = b  or  trans(a) * x = b<a name='2138'>
c     using the factors computed by dgbco or dgbfa.<a name='2139'>
c<a name='2140'>
c<a name='2141'>
      double precision ddot,t<a name='2142'>
      integer k,kb,l,la,lb,lm,m,nm1<a name='2143'>
c<a name='2144'>
      m = mu + ml + 1<a name='2145'>
      nm1 = n - 1<a name='2146'>
      if (job .ne. 0) go to 50<a name='2147'>
c<a name='2148'>
c        job = 0 , solve  a * x = b<a name='2149'>
c        first solve l*y = b<a name='2150'>
c<a name='2151'>
         if (ml .eq. 0) go to 30<a name='2152'>
         if (nm1 .lt. 1) go to 30<a name='2153'>
            do 20 k = 1, nm1<a name='2154'>
               lm = min0(ml,n-k)<a name='2155'>
               l = ipvt(k)<a name='2156'>
               t = b(l)<a name='2157'>
               if (l .eq. k) go to 10<a name='2158'>
                  b(l) = b(k)<a name='2159'>
                  b(k) = t<a name='2160'>
   10          continue<a name='2161'>
               call <A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY'>daxpy</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGBSL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DAXPY_8">(lm,t,abd(m+1,k),1,b(k+1),1)<a name='2162'>
   20       continue<a name='2163'>
   30    continue<a name='2164'>
c<a name='2165'>
c        now solve  u*x = y<a name='2166'>
c<a name='2167'>
         do 40 kb = 1, n<a name='2168'>
            k = n + 1 - kb<a name='2169'>
            b(k) = b(k)/abd(m,k)<a name='2170'>
            lm = min0(k,m) - 1<a name='2171'>
            la = m - lm<a name='2172'>
            lb = k - lm<a name='2173'>
            t = -b(k)<a name='2174'>
            call <A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY'>daxpy</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGBSL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DAXPY_9">(lm,t,abd(la,k),1,b(lb),1)<a name='2175'>
   40    continue<a name='2176'>
      go to 100<a name='2177'>
   50 continue<a name='2178'>
c<a name='2179'>
c        job = nonzero, solve  trans(a) * x = b<a name='2180'>
c        first solve  trans(u)*y = b<a name='2181'>
c<a name='2182'>
         do 60 k = 1, n<a name='2183'>
            lm = min0(k,m) - 1<a name='2184'>
            la = m - lm<a name='2185'>
            lb = k - lm<a name='2186'>
            t = <A href='../../html_code/CGEM_2.0/vode.f.html#DDOT'>ddot</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGBSL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DDOT_3">(lm,abd(la,k),1,b(lb),1)<a name='2187'>
            b(k) = (b(k) - t)/abd(m,k)<a name='2188'>
   60    continue<a name='2189'>
c<a name='2190'>
c        now solve trans(l)*x = y<a name='2191'>
c<a name='2192'>
         if (ml .eq. 0) go to 90<a name='2193'>
         if (nm1 .lt. 1) go to 90<a name='2194'>
            do 80 kb = 1, nm1<a name='2195'>
               k = n - kb<a name='2196'>
               lm = min0(ml,n-k)<a name='2197'>
               b(k) = b(k) + <A href='../../html_code/CGEM_2.0/vode.f.html#DDOT'>ddot</A><A href='../../html_code/CGEM_2.0/vode.f.html#DGBSL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DDOT_4">(lm,abd(m+1,k),1,b(k+1),1)<a name='2198'>
               l = ipvt(k)<a name='2199'>
               if (l .eq. k) go to 70<a name='2200'>
                  t = b(l)<a name='2201'>
                  b(l) = b(k)<a name='2202'>
                  b(k) = t<a name='2203'>
   70          continue<a name='2204'>
   80       continue<a name='2205'>
   90    continue<a name='2206'>
  100 continue<a name='2207'>
      return<a name='2208'>
      end<a name='2209'>
<A NAME='DAXPY'><A href='../../html_code/CGEM_2.0/vode.f.html#DAXPY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2210'>
      <font color=#993300>subroutine </font><font color=#cc0000>daxpy</font>(n,da,dx,incx,dy,incy) <A href='../../call_to/DAXPY.html' TARGET='index'>9</A><a name='2211'>
c<a name='2212'>
c     constant times a vector plus a vector.<a name='2213'>
c     uses unrolled loops for increments equal to one.<a name='2214'>
c     jack dongarra, linpack, 3/11/78.<a name='2215'>
c<a name='2216'>
      double precision dx(1),dy(1),da<a name='2217'>
      integer i,incx,incy,ix,iy,m,mp1,n<a name='2218'>
c<a name='2219'>
      if(n.le.0)return<a name='2220'>
      if (da .eq. 0.0d0) return<a name='2221'>
      if(incx.eq.1.and.incy.eq.1)go to 20<a name='2222'>
c<a name='2223'>
c        code for unequal increments or equal increments<a name='2224'>
c          not equal to 1<a name='2225'>
c<a name='2226'>
      ix = 1<a name='2227'>
      iy = 1<a name='2228'>
      if(incx.lt.0)ix = (-n+1)*incx + 1<a name='2229'>
      if(incy.lt.0)iy = (-n+1)*incy + 1<a name='2230'>
      do 10 i = 1,n<a name='2231'>
        dy(iy) = dy(iy) + da*dx(ix)<a name='2232'>
        ix = ix + incx<a name='2233'>
        iy = iy + incy<a name='2234'>
   10 continue<a name='2235'>
      return<a name='2236'>
c<a name='2237'>
c        code for both increments equal to 1<a name='2238'>
c<a name='2239'>
c<a name='2240'>
c        clean-up loop<a name='2241'>
c<a name='2242'>
   20 m = mod(n,4)<a name='2243'>
      if( m .eq. 0 ) go to 40<a name='2244'>
      do 30 i = 1,m<a name='2245'>
        dy(i) = dy(i) + da*dx(i)<a name='2246'>
   30 continue<a name='2247'>
      if( n .lt. 4 ) return<a name='2248'>
   40 mp1 = m + 1<a name='2249'>
      do 50 i = mp1,n,4<a name='2250'>
        dy(i) = dy(i) + da*dx(i)<a name='2251'>
        dy(i + 1) = dy(i + 1) + da*dx(i + 1)<a name='2252'>
        dy(i + 2) = dy(i + 2) + da*dx(i + 2)<a name='2253'>
        dy(i + 3) = dy(i + 3) + da*dx(i + 3)<a name='2254'>
   50 continue<a name='2255'>
      return<a name='2256'>
      end<a name='2257'>
<A NAME='DSCAL'><A href='../../html_code/CGEM_2.0/vode.f.html#DSCAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2258'>
      <font color=#993300>subroutine </font><font color=#cc0000>dscal</font>(n,da,dx,incx) <A href='../../call_to/DSCAL.html' TARGET='index'>9</A><a name='2259'>
c<a name='2260'>
c     scales a vector by a constant.<a name='2261'>
c     uses unrolled loops for increment equal to one.<a name='2262'>
c     jack dongarra, linpack, 3/11/78.<a name='2263'>
c<a name='2264'>
      double precision da,dx(1)<a name='2265'>
      integer i,incx,m,mp1,n,nincx<a name='2266'>
c<a name='2267'>
      if(n.le.0)return<a name='2268'>
      if(incx.eq.1)go to 20<a name='2269'>
c<a name='2270'>
c        code for increment not equal to 1<a name='2271'>
c<a name='2272'>
      nincx = n*incx<a name='2273'>
      do 10 i = 1,nincx,incx<a name='2274'>
        dx(i) = da*dx(i)<a name='2275'>
   10 continue<a name='2276'>
      return<a name='2277'>
c<a name='2278'>
c        code for increment equal to 1<a name='2279'>
c<a name='2280'>
c<a name='2281'>
c        clean-up loop<a name='2282'>
c<a name='2283'>
   20 m = mod(n,5)<a name='2284'>
      if( m .eq. 0 ) go to 40<a name='2285'>
      do 30 i = 1,m<a name='2286'>
        dx(i) = da*dx(i)<a name='2287'>
   30 continue<a name='2288'>
      if( n .lt. 5 ) return<a name='2289'>
   40 mp1 = m + 1<a name='2290'>
      do 50 i = mp1,n,5<a name='2291'>
        dx(i) = da*dx(i)<a name='2292'>
        dx(i + 1) = da*dx(i + 1)<a name='2293'>
        dx(i + 2) = da*dx(i + 2)<a name='2294'>
        dx(i + 3) = da*dx(i + 3)<a name='2295'>
        dx(i + 4) = da*dx(i + 4)<a name='2296'>
   50 continue<a name='2297'>
      return<a name='2298'>
      end<a name='2299'>
<A NAME='DDOT'><A href='../../html_code/CGEM_2.0/vode.f.html#DDOT' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2300'>
      double precision <font color=#993300>function </font><font color=#cc0000>ddot</font>(n,dx,incx,dy,incy) <A href='../../call_to/DDOT.html' TARGET='index'>4</A><a name='2301'>
c<a name='2302'>
c     forms the dot product of two vectors.<a name='2303'>
c     uses unrolled loops for increments equal to one.<a name='2304'>
c     jack dongarra, linpack, 3/11/78.<a name='2305'>
c<a name='2306'>
      double precision dx(1),dy(1),dtemp<a name='2307'>
      integer i,incx,incy,ix,iy,m,mp1,n<a name='2308'>
c<a name='2309'>
      ddot = 0.0d0<a name='2310'>
      dtemp = 0.0d0<a name='2311'>
      if(n.le.0)return<a name='2312'>
      if(incx.eq.1.and.incy.eq.1)go to 20<a name='2313'>
c<a name='2314'>
c        code for unequal increments or equal increments<a name='2315'>
c          not equal to 1<a name='2316'>
c<a name='2317'>
      ix = 1<a name='2318'>
      iy = 1<a name='2319'>
      if(incx.lt.0)ix = (-n+1)*incx + 1<a name='2320'>
      if(incy.lt.0)iy = (-n+1)*incy + 1<a name='2321'>
      do 10 i = 1,n<a name='2322'>
        dtemp = dtemp + dx(ix)*dy(iy)<a name='2323'>
        ix = ix + incx<a name='2324'>
        iy = iy + incy<a name='2325'>
   10 continue<a name='2326'>
      ddot = dtemp<a name='2327'>
      return<a name='2328'>
c<a name='2329'>
c        code for both increments equal to 1<a name='2330'>
c<a name='2331'>
c<a name='2332'>
c        clean-up loop<a name='2333'>
c<a name='2334'>
   20 m = mod(n,5)<a name='2335'>
      if( m .eq. 0 ) go to 40<a name='2336'>
      do 30 i = 1,m<a name='2337'>
        dtemp = dtemp + dx(i)*dy(i)<a name='2338'>
   30 continue<a name='2339'>
      if( n .lt. 5 ) go to 60<a name='2340'>
   40 mp1 = m + 1<a name='2341'>
      do 50 i = mp1,n,5<a name='2342'>
        dtemp = dtemp + dx(i)*dy(i) + dx(i + 1)*dy(i + 1) +<a name='2343'>
     *   dx(i + 2)*dy(i + 2) + dx(i + 3)*dy(i + 3) + dx(i + 4)*dy(i + 4)<a name='2344'>
   50 continue<a name='2345'>
   60 ddot = dtemp<a name='2346'>
      return<a name='2347'>
      end<a name='2348'>
<A NAME='IDAMAX'><A href='../../html_code/CGEM_2.0/vode.f.html#IDAMAX' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2349'>
      integer <font color=#993300>function </font><font color=#cc0000>idamax</font>(n,dx,incx) <A href='../../call_to/IDAMAX.html' TARGET='index'>2</A><a name='2350'>
c<a name='2351'>
c     finds the index of element having max. absolute value.<a name='2352'>
c     jack dongarra, linpack, 3/11/78.<a name='2353'>
c<a name='2354'>
      double precision dx(1),dmax<a name='2355'>
      integer i,incx,ix,n<a name='2356'>
c<a name='2357'>
      idamax = 0<a name='2358'>
      if( n .lt. 1 ) return<a name='2359'>
      idamax = 1<a name='2360'>
      if(n.eq.1)return<a name='2361'>
      if(incx.eq.1)go to 20<a name='2362'>
c<a name='2363'>
c        code for increment not equal to 1<a name='2364'>
c<a name='2365'>
      ix = 1<a name='2366'>
      dmax = dabs(dx(1))<a name='2367'>
      ix = ix + incx<a name='2368'>
      do 10 i = 2,n<a name='2369'>
         if(dabs(dx(ix)).le.dmax) go to 5<a name='2370'>
         idamax = i<a name='2371'>
         dmax = dabs(dx(ix))<a name='2372'>
    5    ix = ix + incx<a name='2373'>
   10 continue<a name='2374'>
      return<a name='2375'>
c<a name='2376'>
c        code for increment equal to 1<a name='2377'>
c<a name='2378'>
   20 dmax = dabs(dx(1))<a name='2379'>
      do 30 i = 2,n<a name='2380'>
         if(dabs(dx(i)).le.dmax) go to 30<a name='2381'>
         idamax = i<a name='2382'>
         dmax = dabs(dx(i))<a name='2383'>
   30 continue<a name='2384'>
      return<a name='2385'>
      end<a name='2386'>
<A NAME='DCOPY'><A href='../../html_code/CGEM_2.0/vode.f.html#DCOPY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2387'>
      <font color=#993300>subroutine  </font><font color=#cc0000>dcopy</font>(n,dx,incx,dy,incy) <A href='../../call_to/DCOPY.html' TARGET='index'>12</A><a name='2388'>
c<a name='2389'>
c     copies a vector, x, to a vector, y.<a name='2390'>
c     uses unrolled loops for increments equal to one.<a name='2391'>
c     jack dongarra, linpack, 3/11/78.<a name='2392'>
c<a name='2393'>
      double precision dx(1),dy(1)<a name='2394'>
      integer i,incx,incy,ix,iy,m,mp1,n<a name='2395'>
c<a name='2396'>
      if(n.le.0)return<a name='2397'>
      if(incx.eq.1.and.incy.eq.1)go to 20<a name='2398'>
c<a name='2399'>
c        code for unequal increments or equal increments<a name='2400'>
c          not equal to 1<a name='2401'>
c<a name='2402'>
      ix = 1<a name='2403'>
      iy = 1<a name='2404'>
      if(incx.lt.0)ix = (-n+1)*incx + 1<a name='2405'>
      if(incy.lt.0)iy = (-n+1)*incy + 1<a name='2406'>
      do 10 i = 1,n<a name='2407'>
        dy(iy) = dx(ix)<a name='2408'>
        ix = ix + incx<a name='2409'>
        iy = iy + incy<a name='2410'>
   10 continue<a name='2411'>
      return<a name='2412'>
c<a name='2413'>
c        code for both increments equal to 1<a name='2414'>
c<a name='2415'>
c<a name='2416'>
c        clean-up loop<a name='2417'>
c<a name='2418'>
   20 m = mod(n,7)<a name='2419'>
      if( m .eq. 0 ) go to 40<a name='2420'>
      do 30 i = 1,m<a name='2421'>
        dy(i) = dx(i)<a name='2422'>
   30 continue<a name='2423'>
      if( n .lt. 7 ) return<a name='2424'>
   40 mp1 = m + 1<a name='2425'>
      do 50 i = mp1,n,7<a name='2426'>
        dy(i) = dx(i)<a name='2427'>
        dy(i + 1) = dx(i + 1)<a name='2428'>
        dy(i + 2) = dx(i + 2)<a name='2429'>
        dy(i + 3) = dx(i + 3)<a name='2430'>
        dy(i + 4) = dx(i + 4)<a name='2431'>
        dy(i + 5) = dx(i + 5)<a name='2432'>
        dy(i + 6) = dx(i + 6)<a name='2433'>
   50 continue<a name='2434'>
      return<a name='2435'>
      end<a name='2436'>
C<a name='2437'>
C<a name='2438'>
C<a name='2439'>
C DDIFCOEF    Calculates molecular and ionic diffusion coefficients,<a name='2440'>
C             D(i), for a set of species listed below at given<a name='2441'>
C             conditions of salinity, S, temperature, T, and pressure, P<a name='2442'>
C             Also calculated is the shear viscosity of this solution.<a name='2443'>
C<a name='2444'>
C             (Double Precision Version)<a name='2445'>
C<a name='2446'>
C             Diffusion coefficients are:<a name='2447'>
C<a name='2448'>
C                  D(1) = H2O<a name='2449'>
C                  D(2) = O2<a name='2450'>
C                  D(3) = CO2<a name='2451'>
C                  D(4) = NH3<a name='2452'>
C                  D(5) = H2S<a name='2453'>
C                  D(6) = H3PO4<a name='2454'>
C                  D(7) = B(OH)3<a name='2455'>
C                  D(8) = HCO3-<a name='2456'>
C                  D(9) = CO3=<a name='2457'>
C                  D(10) = NH4+<a name='2458'>
C                  D(11) = HS-<a name='2459'>
C                  D(12) = NO3-<a name='2460'>
C                  D(13) = H2PO4-<a name='2461'>
C                  D(14) = HPO4=<a name='2462'>
C                  D(15) = PO4(---)<a name='2463'>
C                  D(16) = B(0H)4-<a name='2464'>
C                  D(17) = H+<a name='2465'>
C                  D(18) = OH-<a name='2466'>
C                  D(19) = Ca++<a name='2467'>
C                  D(20) = Mg++<a name='2468'>
C                  D(21) = Fe++<a name='2469'>
C                  D(22) = Mn++<a name='2470'>
C                  D(23) = SO4=<a name='2471'>
C                  D(24) = H4SiO4<a name='2472'>
C<a name='2473'>
C<a name='2474'>
C             Note: 1) enter S in ppt, T in deg. C and P in atm.<a name='2475'>
C                   2) diffusion coefficients are in units of cm**2/s<a name='2476'>
C                   3) H2O viscosity is in unit of centipoise<a name='2477'>
C<a name='2478'>
C<a name='2479'>
<A NAME='DDIFCOEF'><A href='../../html_code/CGEM_2.0/vode.f.html#DDIFCOEF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2480'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>DDIFCOEF</font>(V,D,S,T,P) <A href='../../call_to/DDIFCOEF.html' TARGET='index'>1</A>,<A href='../../call_from/DDIFCOEF.html' TARGET='index'>7</A><a name='2481'>
      IMPLICIT REAL*8 (A-H,O-Z)<a name='2482'>
      REAL*8 MW,L01,L02,L03,L00<a name='2483'>
      PARAMETER (N=24)<a name='2484'>
      DIMENSION D(N)<a name='2485'>
      DATA ZERO/0.0D+00/,ONE/1.0D+00/,TWO/2.0D+00/,THREE/3.0D+00/<a name='2486'>
      PP = P*1.013<a name='2487'>
      TK = T + 273.15<a name='2488'>
C<a name='2489'>
C  Calculate density of pure water at 25 deg C and sample temperature<a name='2490'>
C<a name='2491'>
      TS = 25.0<a name='2492'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#WATER'>WATER</A><A href='../../html_code/CGEM_2.0/vode.f.html#DDIFCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WATER_1">(TS,R25)<a name='2493'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#WATER'>WATER</A><A href='../../html_code/CGEM_2.0/vode.f.html#DDIFCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WATER_2">(T,RHO)<a name='2494'>
C<a name='2495'>
C  Calculate the viscosity for the true sample conditions.<a name='2496'>
C<a name='2497'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VISCO'>VISCO</A><A href='../../html_code/CGEM_2.0/vode.f.html#DDIFCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VISCO_1">(V,S,T,P)<a name='2498'>
C<a name='2499'>
C  Start calculations of diffusion coefficients in pure water<a name='2500'>
C  at sample temperature.<a name='2501'>
C<a name='2502'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VISCO'>VISCO</A><A href='../../html_code/CGEM_2.0/vode.f.html#DDIFCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VISCO_2">(V0,ZERO,T,ONE)<a name='2503'>
C<a name='2504'>
C  Water : from Cohen and Turnbull (1959) and Krynicki et al. (1978)<a name='2505'>
C<a name='2506'>
      A = 12.5D-09*DEXP(-5.22D-04*P)<a name='2507'>
      B = 925.0*DEXP(-2.6D-04*P)<a name='2508'>
      T0 = 95.0 + 2.61D-02*P<a name='2509'>
      D(1) = A*DSQRT(TK)*DEXP(-B/(TK-T0))*1.0D+04<a name='2510'>
C<a name='2511'>
C<a name='2512'>
C  Dissolved gases : from Wilke and Chang (1955)<a name='2513'>
C    note: 1) MW = molecular weight of water<a name='2514'>
C          2) VM = molar volumes (cm**3/mol) (Sherwood et al., 1975)<a name='2515'>
C<a name='2516'>
C  The factor PHI is reduced to 2.26 as suggested by Hayduk and<a name='2517'>
C  Laudie (1974).<a name='2518'>
C<a name='2519'>
C<a name='2520'>
      PHI = 2.26<a name='2521'>
      MW = 18.0<a name='2522'>
      A = DSQRT(PHI*MW)*TK/V0<a name='2523'>
C<a name='2524'>
C  Oxygen<a name='2525'>
C<a name='2526'>
      VM = 25.6<a name='2527'>
      D(2) = 7.4D-08*(A/(VM**0.6))<a name='2528'>
C<a name='2529'>
C  CO2<a name='2530'>
C<a name='2531'>
      VM = 34.0<a name='2532'>
      D(3) = 7.4D-08*(A/(VM**0.6))<a name='2533'>
C<a name='2534'>
C  NH3<a name='2535'>
C<a name='2536'>
      VM = 25.8<a name='2537'>
      D(4) = 7.4D-08*(A/(VM**0.6))<a name='2538'>
C<a name='2539'>
C  H2S<a name='2540'>
C<a name='2541'>
      VM = 32.9<a name='2542'>
      D(5) = 7.4D-08*(A/(VM**0.6))<a name='2543'>
C<a name='2544'>
C<a name='2545'>
C  The coefficients in pure water for the following species are<a name='2546'>
C  calculated by assuming a linear function of temperature (deg C)<a name='2547'>
C  between 0 and 25 deg C, and using the values given by Li and<a name='2548'>
C  Gregory (1974) to obtain the parameter values.<a name='2549'>
C<a name='2550'>
C  i.e. NO3-,HS-,H2PO4-,CO3=,SO4=,Ca++,Mg++,Mn++,Fe++,NH4+,H+ &amp; OH-<a name='2551'>
C<a name='2552'>
C<a name='2553'>
      FAC = 1.0D-05<a name='2554'>
      D(9) = (0.439 + 0.0206*T)*FAC<a name='2555'>
      D(10) = (0.98 + 0.04*T)*FAC<a name='2556'>
      D(11) = (0.975 + 0.03*T)*FAC<a name='2557'>
      D(12) = (0.978 + 0.0369*T)*FAC<a name='2558'>
      D(13) = (0.378 + 0.0187*T)*FAC<a name='2559'>
      D(17) = (5.61 + 0.148*T)*FAC<a name='2560'>
      D(18) = (2.56 + 0.1084*T)*FAC<a name='2561'>
      D(19) = (0.373 + 0.0168*T)*FAC<a name='2562'>
      D(20) = (0.356 + 0.014*T)*FAC<a name='2563'>
      D(21) = (0.341 + 0.0151*T)*FAC<a name='2564'>
      D(22) = (0.305 + 0.0153*T)*FAC<a name='2565'>
      D(23) = (0.5 + 0.0228*T)*FAC<a name='2566'>
C<a name='2567'>
C<a name='2568'>
C  HCO3-, HPO4= and PO4(---):  don't have limiting<a name='2569'>
C  conductivity at temperatures other than 25 deg C.  Use the<a name='2570'>
C  the reduced state relationship of Marshall (1987) to calculate<a name='2571'>
C  limiting conductivities at other temperatures and the Nernst equation<a name='2572'>
C  to calculate diffusion coefficients.<a name='2573'>
C<a name='2574'>
C  (note: assumes the RHOh parameter is a constant independent of T.)<a name='2575'>
C<a name='2576'>
C<a name='2577'>
      R = 8.3143<a name='2578'>
      F2 = 96490.0**2<a name='2579'>
      TS = 25.0<a name='2580'>
      A = ONE/850.0<a name='2581'>
      B1 = 1.33669D-06<a name='2582'>
      B2 = 1.68178D-07<a name='2583'>
      B3 = - 1.52321D-09<a name='2584'>
      B4 = 5.61864D-12<a name='2585'>
      L00 = TS*(B1 + TS*(B2 + TS*(B3 + TS*B4)))<a name='2586'>
      L00 = 950.0 - ONE/(A + L00)<a name='2587'>
      L01 = 44.5<a name='2588'>
      L02 = 55.14<a name='2589'>
      L03 = 68.96<a name='2590'>
      RH1 = R25*L00/(L00 - L01)<a name='2591'>
      RH2 = R25*L00/(L00 - L02)<a name='2592'>
      RH3 = R25*L00/(L00 - L03)<a name='2593'>
      L00 = T*(B1 + T*(B2 + T*(B3 + T*B4)))<a name='2594'>
      L00 = 950.0 - ONE/(A + L00)<a name='2595'>
      L01 = L00*(ONE - RHO/RH1)<a name='2596'>
      L02 = L00*(ONE - RHO/RH2)<a name='2597'>
      L03 = L00*(ONE - RHO/RH3)<a name='2598'>
      D(8) = R*TK*L01/F2<a name='2599'>
      D(14) = R*TK*L02/F2/TWO<a name='2600'>
      D(15) = R*TK*L03/F2/THREE<a name='2601'>
C<a name='2602'>
C H3PO4 : Least (1984) determined D(H3PO4) at 25 deg C and 0 ppt S.<a name='2603'>
C         Assume that this value can be scaled by the Stokes-Einstein<a name='2604'>
C         relationship to any other temperature and salinity.<a name='2605'>
C<a name='2606'>
      D(6) = 0.87D-05<a name='2607'>
      SS = 25.0<a name='2608'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VISCO'>VISCO</A><A href='../../html_code/CGEM_2.0/vode.f.html#DDIFCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VISCO_3">(VSTP,ZERO,SS,ONE)<a name='2609'>
      D(6) = D(6)*VSTP/298.15*TK/V0<a name='2610'>
C<a name='2611'>
C  B(OH)3 : Mackin (1986) determined D(B(OH)3) at 25 deg C and<a name='2612'>
C           about 29.2 ppt S.<a name='2613'>
C           Assume that this value can be scaled by the Stokes-Einstein<a name='2614'>
C           relationship to any other temperature and salinity.<a name='2615'>
C<a name='2616'>
      D(7) = 1.12D-05<a name='2617'>
      TS = 29.2<a name='2618'>
      SS = 25.0<a name='2619'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VISCO'>VISCO</A><A href='../../html_code/CGEM_2.0/vode.f.html#DDIFCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VISCO_4">(V29,TS,SS,ONE)<a name='2620'>
      D(7) = D(7)*V29/298.15*TK/V0<a name='2621'>
C<a name='2622'>
C  B(OH)4 : No information on this species whatsoever<font color=#447700>! Boudreau and<a name='2623'></font>
C           Canfield (1988) assume it is 12.5% smaller than B(OH)3.<a name='2624'>
C<a name='2625'>
      D(16) = 0.875*D(7)<a name='2626'>
C<a name='2627'>
C  H4SiO4 : Wollast and Garrels (1971) found D(H4SiO4) at 25 deg C<a name='2628'>
C           and 36.1 ppt S.<a name='2629'>
C           Assume that this value can be scaled by the Stokes-Einstein<a name='2630'>
C           relationship to any other temperature and salinity.<a name='2631'>
C<a name='2632'>
      D(24) = 1.0E-05<a name='2633'>
      TS = 36.1<a name='2634'>
      SS = 25.0<a name='2635'>
      CALL <A href='../../html_code/CGEM_2.0/vode.f.html#VISCO'>VISCO</A><A href='../../html_code/CGEM_2.0/vode.f.html#DDIFCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VISCO_5">(V36,TS,SS,ONE)<a name='2636'>
      D(24) = D(24)*V36/298.15*TK/V0<a name='2637'>
C<a name='2638'>
C  To correct for salinity, the Stokes-Einstein relationship is used.<a name='2639'>
C  (This is not quite accurate, but is at least consistant.)<a name='2640'>
C<a name='2641'>
      FAC = V0/V<a name='2642'>
      DO 10 I=1,N<a name='2643'>
   10 D(I) = D(I)*FAC<a name='2644'>
C<a name='2645'>
      RETURN<a name='2646'>
      END<a name='2647'>
C<a name='2648'>
C<a name='2649'>
C<a name='2650'>
C  VISCO      Calculates the shear viscosity of water using the equation<a name='2651'>
C             given by Kukulka et al. (1987).<a name='2652'>
C             Calculated viscosity is in centipoise.<a name='2653'>
C<a name='2654'>
C             Valid for 0&lt;T&lt;30 and 0&lt;S&lt;36.<a name='2655'>
C<a name='2656'>
<A NAME='VISCO'><A href='../../html_code/CGEM_2.0/vode.f.html#VISCO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2657'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VISCO</font>(V,S,T,P) <A href='../../call_to/VISCO.html' TARGET='index'>5</A><a name='2658'>
      IMPLICIT REAL*8 (A-H,O-Z)<a name='2659'>
      V =  1.7910 - T*(6.144D-02 - T*(1.4510D-03 - T*1.6826D-05))<a name='2660'>
     # - 1.5290D-04*P + 8.3885D-08*P*P + 2.4727D-03*S<a name='2661'>
     # + (6.0574D-06*P - 2.6760D-09*P*P)*T + (T*(4.8429D-05<a name='2662'>
     # - T*(4.7172D-06 - T*7.5986D-08)))*S<a name='2663'>
      RETURN<a name='2664'>
      END<a name='2665'>
C<a name='2666'>
C<a name='2667'>
C<a name='2668'>
C  WATER      Calculates the density of pure water using the equation<a name='2669'>
C             given by Bigg (1967).  (see Millero and Poisson, 1981)<a name='2670'>
C<a name='2671'>
<A NAME='WATER'><A href='../../html_code/CGEM_2.0/vode.f.html#WATER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2672'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>WATER</font>(T,RHO) <A href='../../call_to/WATER.html' TARGET='index'>2</A><a name='2673'>
      IMPLICIT REAL*8 (A-H,O-Z)<a name='2674'>
      RHO =  999.842594 + T*(6.793952D-02 + T*(-9.09529D-03<a name='2675'>
     #       + T*(1.001685D-04 + T*(-1.120083D-06 + T*6.536336D-09))))<a name='2676'>
      RHO = RHO/1000.0<a name='2677'>
      RETURN<a name='2678'>
      END<a name='2679'>
</pre></body></html>